<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- 
    ============================================
    H ERSPOTLIGHT - ETHIOPIAN FASHION MARKETPLACE
    ============================================
    
    A responsive e-commerce platform connecting Ethiopian fashion sellers 
    with buyers through beautiful, authentic designs.
    
    Features:
    - Seller dashboard with product management
    - Buyer feed with personalized recommendations
    - AI-powered product descriptions
    - Service management (delivery, tailoring, consultation)
    - Favorites system and user profiles
    - Responsive design for all devices
    
    Author: HerSpotlight Team
    Version: 1.0.0
    Last Updated: 2024
    -->

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HerSpotlight - Ethiopian Fashion Marketplace</title>

    <!-- Import Tailwind CSS - Utility-first CSS framework for rapid UI development -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Import Google Font (Poppins) - Modern, clean typography for better readability -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Firebase SDK (COMMENTED OUT) - Real-time database and authentication -->
    <script type="module">
      // Import Firebase modules (COMMENTED OUT)
      // Firebase provides real-time database, authentication, and cloud storage
      // Currently using mock data for demonstration purposes
      /*
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, 
            onAuthStateChanged, 
            signInAnonymously,
            signInWithCustomToken
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, 
            doc, 
            setDoc, 
            getDoc, 
            addDoc, 
            collection, 
            query, 
            where, 
            onSnapshot,
            setLogLevel
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        */

      // --- GLOBAL STATE & CONFIG ---

      // Firebase Config (COMMENTED OUT)
      /*
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        */

      // ============================================
      // GLOBAL VARIABLES AND STATE MANAGEMENT
      // ============================================

      // Initialize Firebase (COMMENTED OUT) - Real-time database and authentication
      let app, auth, db, userId, productsCollection, buyerProfileDoc;

      // Mock data for UI demonstration - Realistic Ethiopian fashion products
      let allProducts = [
        {
          id: "1",
          title: "Handmade Habesha Kemis",
          price: 1200,
          imageUrl:
            "https://images.unsplash.com/photo-1594736797933-d0401ba2fe65?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1000&q=80",
          style: "Boho",
          tags: ["Handmade", "Cultural", "Traditional"],
          descriptionEN:
            "Exquisite traditional Ethiopian dress featuring intricate hand-embroidered patterns. Made with premium cotton fabric and traditional weaving techniques passed down through generations.",
          descriptionAM: "ውብ ባህላዊ ኢትዮጵያዊ ቀሚስ በደባልቃ ስፌት እና ባህላዊ የስፌት ቴክኒኮች የተሰራ",
          views: 156,
          contacts: 23,
          category: "Dress",
          sellerId: "seller-amina",
          deliveryStatus: "none", // none, pending, accepted, on_the_way, delivered
        },
        {
          id: "2",
          title: "Elegant White Kemis",
          price: 950,
          imageUrl:
            "https://images.unsplash.com/photo-1515372039744-b8f02a3ae446?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1000&q=80",
          style: "Minimal",
          tags: ["Modern", "Elegant", "White"],
          descriptionEN:
            "Contemporary take on traditional Ethiopian fashion. Clean lines and minimalist design perfect for modern occasions while honoring cultural heritage.",
          descriptionAM:
            "ዘመናዊ ኢትዮጵያዊ ፋሽን ባህላዊ ክህደትን የሚያክብር እና ዘመናዊ ክስተቶች የሚስማማ",
          views: 89,
          contacts: 15,
          category: "Dress",
          sellerId: "seller-amina",
          deliveryStatus: "none",
        },
        {
          id: "3",
          title: "Vibrant Cultural Blouse",
          price: 750,
          imageUrl:
            "https://images.unsplash.com/photo-1571513723812-70c5b7b7b8b8?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1000&q=80",
          style: "Bright",
          tags: ["Colorful", "Cultural", "Handmade"],
          descriptionEN:
            "Bold and beautiful traditional blouse featuring vibrant Ethiopian patterns. Handcrafted with attention to detail and cultural authenticity.",
          descriptionAM: "ብሩህ ቀለሞች እና ቆንጆ ቅርጸት ያለው ባህላዊ ትልቅ ሸሚዝ በእጅ የተሰራ",
          views: 67,
          contacts: 12,
          category: "Top",
          sellerId: "seller-amina",
          deliveryStatus: "none",
        },
        {
          id: "4",
          title: "Artisan Woven Scarf",
          price: 450,
          imageUrl:
            "https://images.unsplash.com/photo-1601925260369-7b4b4a0b8b8b?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1000&q=80",
          style: "Earthy",
          tags: ["Scarf", "Accessory", "Natural"],
          descriptionEN:
            "Luxurious handwoven scarf in natural earth tones. Perfect accessory for any outfit, crafted by skilled Ethiopian artisans.",
          descriptionAM: "በተፈጥሮ የምድር ቀለሞች የተሰራ የእጅ የተሰራ ሸሚዝ",
          views: 43,
          contacts: 8,
          category: "Accessories",
          sellerId: "seller-amina",
          deliveryStatus: "none",
        },
        {
          id: "5",
          title: "Modern Ethiopian Jumpsuit",
          price: 1800,
          imageUrl:
            "https://images.unsplash.com/photo-1594633312681-425c7b97ccd1?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1000&q=80",
          style: "Modern",
          tags: ["Contemporary", "Stylish", "Unique"],
          descriptionEN:
            "Contemporary Ethiopian-inspired jumpsuit blending traditional patterns with modern silhouettes. A statement piece for the fashion-forward.",
          descriptionAM: "ባህላዊ ቅርጸቶችን ከዘመናዊ ስልቶች ጋር የሚያጣምር ዘመናዊ ኢትዮጵያዊ የሆነ ጩሚስ",
          views: 124,
          contacts: 19,
          category: "Dress",
          sellerId: "seller-amina",
          deliveryStatus: "none",
        },
        {
          id: "6",
          title: "Traditional Ethiopian Skirt",
          price: 680,
          imageUrl:
            "https://images.unsplash.com/photo-1571513723812-70c5b7b7b8b8?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1000&q=80",
          style: "Traditional",
          tags: ["Traditional", "Cultural", "Handmade"],
          descriptionEN:
            "Authentic Ethiopian skirt featuring traditional weaving patterns. Comfortable and elegant, perfect for cultural celebrations.",
          descriptionAM: "ባህላዊ የስፌት ቅርጸቶች ያለው እውነተኛ ኢትዮጵያዊ ስካርት",
          views: 78,
          contacts: 14,
          category: "Bottom",
          sellerId: "seller-amina",
          deliveryStatus: "none",
        },
      ];

      // ============================================
      // USER STATE MANAGEMENT VARIABLES
      // ============================================

      let userProfile = { style: null, buyerId: "buyer-sarah" }; // User preferences and style profile
      let currentProduct = null; // Currently selected product for detail view
      let currentUserType = null; // 'seller', 'buyer', or 'delivery' - determines UI flow
      let sellerProducts = []; // Store seller's uploaded products
      let favoriteProducts = []; // Store user's favorite products
      let currentFilter = "all"; // Current filter state for product browsing
      let searchQuery = ""; // Current search query for product filtering

      // --- MOCK DELIVERY DATA ---
      let deliveryJobs = [
        {
          id: "delivery-1",
          productId: "1",
          productTitle: "Traditional Habesha Kemis",
          pickupLocation: "Addis Ababa, Bole",
          dropoffLocation: "Addis Ababa, Kazanchis",
          status: "pending",
          price: 1200,
          deliveryFee: 50,
          customerName: "Sarah M.",
          customerPhone: "+251 91 234 5678",
          reason: "New delivery request",
        },
        {
          id: "delivery-2",
          productId: "2",
          productTitle: "Modern Ethiopian Blouse",
          pickupLocation: "Addis Ababa, Piazza",
          dropoffLocation: "Addis Ababa, CMC",
          status: "pending",
          price: 800,
          deliveryFee: 50,
          customerName: "Amina K.",
          customerPhone: "+251 92 345 6789",
          reason: "Urgent delivery needed",
        },
      ]; // Mock "deliveryJobs" collection
      let deliveryProfiles = {}; // Mock "deliveryProfiles" collection
      let currentDeliveryPersonId = null; // 'delivery-dani'

      // --- ICON SVGS ---
      const icons = {
        settings: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 .54 1.84l-.05.3a2 2 0 0 1-1.6 1.6l-.3.05a2 2 0 0 1-1.84-.54l-.1-.15a2 2 0 0 0-2.73-.73l-.38.22a2 2 0 0 0-.73 2.73l.08-.15a2 2 0 0 1 0-2l.08-.15a2 2 0 0 0-.73-2.73l-.38-.22a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 .54 1.84l-.05.3a2 2 0 0 1-1.6 1.6l-.3.05a2 2 0 0 1-1.84-.54l-.1-.15a2 2 0 0 0-2.73-.73l-.38.22a2 2 0 0 0-.73 2.73l.08.15a2 2 0 0 1 0 2l-.08.15a2 2 0 0 0 .73 2.73l.38.22a2 2 0 0 0 2.73-.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-.54-1.84l.05-.3a2 2 0 0 1 1.6-1.6l.3-.05a2 2 0 0 1 1.84.54l.1.15a2 2 0 0 0 2.73.73l.38-.22a2 2 0 0 0 .73-2.73l-.08-.15a2 2 0 0 1 0-2l.08-.15a2 2 0 0 0-.73-2.73l-.38-.22a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>`,
        camera: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></svg>`,
        sparkles: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/><path d="M18 3v4"/><path d="M21 6h-4"/><path d="M3 12h4"/><path d="M6 9v4"/><path d="M18 12h4"/><path d="M21 15h-4"/><path d="M12 18v4"/><path d="M9 21v-4"/></svg>`,
        rocket: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.3.0-3.08S5.2 15.66 4.5 16.5z"/><path d="m12 15-3-3 3-3 3 3-3 3z"/><path d="m19 5-3-3 3-3 3 3-3 3z"/><path d="m22 19-3-3 3-3 3 3-3 3z"/><path d="M10.22 10.22 17 3l-3.47 6.53"/><path d="m9 15 6.53-3.47L22 17l-6.53 3.47z"/></svg>`,
        globe: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"/><path d="M2 12h20"/></svg>`,
        whatsapp: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12.04 2C6.58 2 2.13 6.45 2.13 11.91C2.13 13.66 2.59 15.36 3.45 16.86L2.06 21.94L7.3 20.58C8.75 21.37 10.35 21.8 12.04 21.8H12.05C17.5 21.8 21.95 17.35 21.95 11.9C21.95 9.22 20.9 6.73 19.01 4.84C17.12 2.95 14.63 2 12.04 2ZM10.13 5.95H10.15C10.51 5.95 10.86 5.96 11.19 5.98C11.52 5.99 11.83 6.01 12.12 6.04C12.42 6.06 12.7 6.09 12.97 6.13C13.24 6.17 13.5 6.22 13.76 6.29C14.01 6.36 14.25 6.44 14.49 6.54C14.73 6.63 14.96 6.74 15.17 6.86C15.4 6.98 15.6 7.12 15.8 7.28C16 7.44 16.18 7.62 16.34 7.82C16.5 8.02 16.65 8.23 16.78 8.45C16.91 8.68 17.02 8.92 17.12 9.17C17.21 9.42 17.28 9.68 17.34 9.94C17.4 10.2 17.45 10.47 17.48 10.74C17.51 11.01 17.53 11.3 17.54 11.59C17.55 11.88 17.55 12.16 17.55 12.42C17.55 12.7 17.55 12.97 17.54 13.23C17.53 13.52 17.51 13.81 17.48 14.08C17.45 14.35 17.4 14.62 17.34 14.88C17.28 15.14 17.21 15.4 17.12 15.65C17.02 15.9 16.91 16.14 16.78 16.37C16.65 16.59 16.5 16.8 16.34 17C16.18 17.2 16 17.38 15.8 17.54C15.6 17.7 15.4 17.84 15.17 17.96C14.96 18.08 14.73 18.19 14.49 18.28C14.25 18.38 14.01 18.46 13.76 18.53C13.5 18.6 13.24 18.65 12.97 18.69C12.7 18.73 12.42 18.76 12.12 18.78C11.83 18.81 11.52 18.83 11.19 18.84C10.86 18.86 10.51 18.87 10.15 18.87H10.13C9.77 18.87 9.42 18.86 9.09 18.84C8.76 18.83 8.45 18.81 8.16 18.78C7.86 18.76 7.58 18.73 7.31 18.69C7.04 18.65 6.78 18.6 6.52 18.53C6.27 18.46 6.03 18.38 5.79 18.28C5.55 18.19 5.32 18.08 5.11 17.96C4.88 17.84 4.68 17.7 4.48 17.54C4.28 17.38 4.1 17.2 3.94 17C3.78 16.8 3.63 16.59 3.5 16.37C3.37 16.14 3.26 15.9 3.16 15.65C3.07 15.4 3 15.14 2.94 14.88C2.88 14.62 2.83 14.35 2.8 14.08C2.77 13.81 2.75 13.52 2.74 13.23C2.73 12.97 2.73 12.7 2.73 12.42C2.73 12.16 2.73 11.88 2.74 11.59C2.75 11.3 2.77 11.01 2.8 10.74C2.83 10.47 2.88 10.2 2.94 9.94C3 9.68 3.07 9.42 3.16 9.17C3.26 8.92 3.37 8.68 3.5 8.45C3.63 8.23 3.78 8.02 3.94 7.82C4.1 7.62 4.28 7.44 4.48 7.28C4.68 7.12 4.88 6.98 5.11 6.86C5.32 6.74 5.55 6.63 5.79 6.54C6.03 6.44 6.27 6.36 6.52 6.29C6.78 6.22 7.04 6.17 7.31 6.13C7.58 6.09 7.86 6.06 8.16 6.04C8.45 6.01 8.76 5.99 9.09 5.98C9.42 5.96 9.77 5.95 10.13 5.95ZM8.53 7.3C8.41 7.3 8.29 7.3 8.18 7.31C7.94 7.32 7.71 7.35 7.48 7.39C7.25 7.43 7.03 7.48 6.81 7.55C6.59 7.62 6.38 7.7 6.17 7.79C5.97 7.88 5.77 7.99 5.58 8.1C5.39 8.21 5.21 8.34 5.04 8.48C4.87 8.62 4.71 8.78 4.56 8.95C4.41 9.12 4.28 9.3 4.16 9.49C4.04 9.68 3.93 9.88 3.84 10.09C3.75 10.3 3.67 10.51 3.61 10.73C3.54 10.95 3.49 11.17 3.45 11.4C3.41 11.63 3.38 11.86 3.37 12.1C3.36 12.21 3.36 12.33 3.36 12.45C3.36 12.57 3.36 12.69 3.37 12.81C3.38 13.04 3.41 13.27 3.45 13.5C3.49 13.73 3.54 13.95 3.61 14.17C3.67 14.39 3.75 14.6 3.84 14.81C3.93 15.02 4.04 15.22 4.16 15.41C4.28 15.6 4.41 15.78 4.56 15.95C4.71 16.12 4.87 16.28 5.04 16.42C5.21 16.56 5.39 16.69 5.58 16.8C5.77 16.91 5.97 17.02 6.17 17.11C6.38 17.2 6.59 17.28 6.81 17.35C7.03 17.42 7.25 17.47 7.48 17.51C7.71 17.55 7.94 17.58 8.18 17.59C8.29 17.6 8.41 17.6 8.53 17.6C8.91 17.6 9.28 17.58 9.63 17.54C9.98 17.5 10.32 17.43 10.65 17.34C10.98 17.25 11.3 17.13 11.61 17C11.92 16.87 12.21 16.71 12.49 16.54C12.77 16.37 13.03 16.18 13.27 15.97C13.51 15.76 13.74 15.53 13.94 15.28C14.14 15.03 14.32 14.77 14.48 14.49C14.64 14.21 14.78 13.92 14.9 13.61C15.02 13.3 15.12 12.98 15.19 12.65C15.26 12.32 15.3 11.98 15.3 11.63C15.3 11.28 15.26 10.94 15.19 10.61C15.12 10.28 15.02 9.96 14.9 9.65C14.78 9.34 14.64 9.05 14.48 8.77C14.32 8.49 14.14 8.23 13.94 7.98C13.74 7.73 13.51 7.5 13.27 7.29C13.03 7.08 12.77 6.89 12.49 6.72C12.21 6.55 11.92 6.39 11.61 6.26C11.3 6.13 10.98 6.01 10.65 5.92C10.32 5.83 9.98 5.76 9.63 5.72C9.28 5.68 8.91 5.66 8.53 5.66L8.53 7.3Z"/></svg>`,
        copy: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>`,
        eye: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>`,
        message: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"/></svg>`,
        heart: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>`,
        home: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>`,
        user: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>`,
        dress: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>`,
        shoppingBag: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/><path d="M3 6h18"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>`,
        check: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>`,
        chevronLeft: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>`,
        loader: `<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" stroke="currentColor"><style>.spinner_V8m1{transform-origin:center;animation:spinner_zKoa 2s linear infinite}.spinner_V8m1 circle{stroke-linecap:round;animation:spinner_YpZS 1.5s ease-in-out infinite}@keyframes spinner_zKoa{100%{transform:rotate(360deg)}}@keyframes spinner_YpZS{0%{stroke-dasharray:0 150;stroke-dashoffset:0}47.5%{stroke-dasharray:42 150;stroke-dashoffset:-16}95%,100%{stroke-dasharray:42 150;stroke-dashoffset:-59}}</style><circle class="spinner_V8m1" cx="12" cy="12" r="9.5" fill="none" stroke-width="3"></circle></svg>`,
        plus: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>`,
        grid: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/></svg>`,
        menu: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>`,
        truck: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 17h4V5H2v12h3m1 0h5m0 0-3 3-3-3m5 0v-3h-2v3m-3-3h-1m14 3h-3v-5h3v5Zm-3-5V8h-6v4h6ZM6 17h1"/><path d="M17 17h2v-3h-2v3m-3 0h-2v-3h2v3m-3 0h-2v-3h2v3m0 0h-1"/></svg>`,
        mapPin: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>`,
        idCard: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M7 7h.01"/><path d="M10 7h4"/><path d="M10 12h4"/><path d="M7 12h.01"/><path d="M10 17h4"/><path d="M7 17h.01"/></svg>`,
        toggleLeft: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="20" height="12" x="2" y="6" rx="6"/><circle cx="8" cy="12" r="2"/></svg>`,
        toggleRight: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="20" height="12" x="2" y="6" rx="6"/><circle cx="16" cy="12" r="2"/></svg>`,
        logOut: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg>`,
      };

      // --- CORE APP LOGIC ---

      /**
       * Initialize the application once the window loads
       */
      window.onload = async () => {
        try {
          // For demo purposes, just set up the UI
          setupEventListeners();
          setupPullToRefresh();

          // Pre-populate seller products for demo
          sellerProducts = allProducts.filter(
            (p) => p.sellerId === "seller-amina"
          );

          showScreen("screen-welcome");
        } catch (error) {
          console.error("Initialization Error:", error);
          // Display a friendly error message to the user
          document.getElementById("app-container").innerHTML = `
                    <div class="p-4 bg-red-100 text-red-700 rounded-lg">
                        <strong>Error:</strong> Could not connect to the application service. Please try refreshing the page.
                    </div>`;
        }
      };

      /**
       * Setup pull-to-refresh functionality for mobile-like experience
       * Allows users to pull down on the feed to refresh content
       */
      function setupPullToRefresh() {
        const feedContent = document.getElementById("feed-content");
        let startY = 0;
        let isPulling = false;

        feedContent.addEventListener(
          "touchstart",
          (e) => {
            if (feedContent.scrollTop === 0) {
              startY = e.touches[0].clientY;
              isPulling = true;
            }
          },
          { passive: true }
        );

        feedContent.addEventListener(
          "touchmove",
          (e) => {
            if (!isPulling) return;

            const currentY = e.touches[0].clientY;
            const diff = currentY - startY;

            if (diff > 50 && feedContent.scrollTop === 0) {
              document
                .getElementById("pull-refresh-indicator")
                .classList.remove("hidden");
            }
          },
          { passive: true }
        );

        feedContent.addEventListener("touchend", async (e) => {
          if (isPulling) {
            const currentY = e.changedTouches[0].clientY;
            const diff = currentY - startY;

            if (diff > 50 && feedContent.scrollTop === 0) {
              await refreshFeed();
            }
            document
              .getElementById("pull-refresh-indicator")
              .classList.add("hidden");
          }
          isPulling = false;
        });
      }

      /**
       * Refresh the feed data
       */
      async function refreshFeed() {
        try {
          // Simulate API call
          await new Promise((resolve) => setTimeout(resolve, 1000));

          // Re-render the feed
          if (currentUserType === "buyer") {
            renderBuyerFeed();
          } else if (currentUserType === "seller") {
            renderSellerDashboard(sellerProducts);
          } else if (currentUserType === "delivery") {
            renderDeliveryDashboard();
          }

          showToast("Feed refreshed!");
        } catch (error) {
          console.error("Error refreshing feed:", error);
          showToast("Failed to refresh feed", true);
        }
      }

      /**
       * Show favorites screen
       */
      function showFavoritesScreen() {
        const favoriteProductsList = allProducts.filter((product) =>
          favoriteProducts.includes(product.id)
        );

        if (favoriteProductsList.length === 0) {
          showToast(
            "No favorites yet! ❤️ Start liking products to see them here."
          );
          return;
        }

        // Show favorites screen
        showScreen("screen-buyer-feed");

        // Create a temporary favorites view
        const container = document.getElementById("buyer-feed-grid");
        const originalContent = container.innerHTML;

        container.innerHTML = favoriteProductsList
          .map((product) => {
            return `
                    <div class="bg-white rounded-xl shadow-sm overflow-hidden hover:shadow-lg transition-shadow duration-200" onclick="window.showProductDetail('${product.id}')">
                        <div class="relative">
                            <img src="${product.imageUrl}" alt="${product.title}" class="w-full h-48 object-cover">
                            <span class="absolute top-2 left-2 bg-gradient-to-r from-pink-500 to-red-500 text-white text-xs font-semibold px-2 py-1 rounded-full">❤️ Favorite</span>
                            <button class="absolute top-2 right-2 w-8 h-8 bg-white/90 rounded-full flex items-center justify-center hover:bg-white transition-colors" onclick="event.stopPropagation(); window.toggleFavorite('${product.id}')" aria-label="Remove from favorites">
                                <svg class="w-4 h-4 text-red-500 fill-current" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                                </svg>
                            </button>
                        </div>
                        <div class="p-3">
                            <h3 class="font-semibold text-charcoal truncate">${product.title}</h3>
                            <p class="text-earthy-red font-medium">${product.price} ETB</p>
                        </div>
                    </div>
                `;
          })
          .join("");

        // Update header title
        const headerTitle = document.querySelector("#screen-buyer-feed h2");
        const originalTitle = headerTitle.textContent;
        headerTitle.textContent = `❤️ My Favorites (${favoriteProductsList.length})`;

        // Show a back button
        const header = document.querySelector("#screen-buyer-feed header");
        const existingBackBtn = header.querySelector(".favorites-back-btn");
        if (existingBackBtn) {
          existingBackBtn.remove();
        }

        const backBtn = document.createElement("button");
        backBtn.className = "btn-ghost text-sm mr-2 favorites-back-btn";
        backBtn.innerHTML = "← Back to Feed";
        backBtn.onclick = () => {
          container.innerHTML = originalContent;
          headerTitle.textContent = originalTitle;
          backBtn.remove();
          renderBuyerFeed();
        };
        header.insertBefore(backBtn, header.firstChild);

        showToast(
          `Showing ${favoriteProductsList.length} favorite${
            favoriteProductsList.length === 1 ? "" : "s"
          } ❤️`
        );
      }

      /**
       * Handle buy product button click - Opens payment modal
       * @param {string} productId The ID of the product to buy
       */
      function handleBuyProduct(productId) {
        const product = allProducts.find((p) => p.id === productId);
        if (!product) {
          showToast("Product not found!", true);
          return;
        }

        // Set current product for payment
        currentProduct = product;

        // Populate payment modal with product details
        const productSummary = document.getElementById(
          "payment-product-summary"
        );
        productSummary.innerHTML = `
          <div class="flex items-center gap-4">
            <img src="${product.imageUrl}" alt="${product.title}" class="w-16 h-16 rounded-xl object-cover">
            <div class="flex-1">
              <h4 class="font-semibold text-charcoal">${product.title}</h4>
              <p class="text-sm text-charcoal/70">${product.category}</p>
              <p class="text-earthy-red font-bold">${product.price} ETB</p>
            </div>
          </div>
        `;

        // Update order summary
        document.getElementById(
          "product-price"
        ).textContent = `${product.price} ETB`;

        // Pre-select delivery option from product detail screen
        if (window.selectedDeliveryOption) {
          const deliveryRadio = document.querySelector(
            `input[name="delivery-option"][value="${window.selectedDeliveryOption}"]`
          );
          if (deliveryRadio) {
            deliveryRadio.checked = true;
          }
        }

        updateOrderTotal();

        // Show payment modal
        showScreen("modal-payment");
      }

      /**
       * Update order total based on delivery option
       */
      function updateOrderTotal() {
        const productPrice = currentProduct ? currentProduct.price : 0;
        const deliveryOption = document.querySelector(
          'input[name="delivery-option"]:checked'
        );
        const deliveryCost =
          deliveryOption && deliveryOption.value === "delivery" ? 50 : 0;
        const total = productPrice + deliveryCost;

        document.getElementById(
          "delivery-cost"
        ).textContent = `${deliveryCost} ETB`;
        document.getElementById("total-price").textContent = `${total} ETB`;
      }

      /**
       * Handle payment completion
       */
      async function handleCompletePurchase() {
        const deliveryOption = document.querySelector(
          'input[name="delivery-option"]:checked'
        );
        const paymentMethod = document.querySelector(
          'input[name="payment-method"]:checked'
        );

        if (!deliveryOption || !paymentMethod) {
          showToast("Please select delivery and payment options", true);
          return;
        }

        // Show loading state
        setButtonLoading(document.getElementById("confirm-purchase"), true);

        try {
          // Simulate payment processing
          await new Promise((resolve) => setTimeout(resolve, 2000));

          // Success message based on options
          let message = `🎉 Purchase successful! `;
          if (deliveryOption.value === "pickup") {
            message += `You can pick up your ${currentProduct.title} at the store.`;
          } else {
            message += `Your ${currentProduct.title} will be delivered today!`;
          }

          if (paymentMethod.value === "cash") {
            message += ` Pay ${
              document.getElementById("total-price").textContent
            } on delivery.`;
          } else {
            message += ` Payment processed via mobile payment.`;
          }

          showToast(message);

          // Close payment modal
          hideScreen("modal-payment");

          // Reset form
          currentProduct = null;
        } catch (error) {
          showToast("Payment failed. Please try again.", true);
        } finally {
          setButtonLoading(document.getElementById("confirm-purchase"), false);
        }
      }

      /**
       * Setup all event listeners for buttons and forms
       */
      function setupEventListeners() {
        // Welcome Screen
        document.getElementById("btn-seller").onclick = (e) => {
          addButtonPressEffect(e.target);
          currentUserType = "seller";
          console.log(
            "Seller clicked, sellerProducts.length:",
            sellerProducts.length
          ); // Debug log
          // Check if seller has any products
          if (sellerProducts.length === 0) {
            // First time seller - go to upload
            console.log("First time seller - going to upload"); // Debug log
            showScreen("screen-upload-product");
            showToast(
              "Welcome! Let's create your first product to set up your workspace! 🎉"
            );
          } else {
            // Existing seller - go to workspace
            console.log("Existing seller - going to workspace"); // Debug log
            showScreen("screen-seller-workspace");
            renderSellerWorkspace();
          }
        };
        document.getElementById("btn-buyer").onclick = (e) => {
          addButtonPressEffect(e.target);
          currentUserType = "buyer";
          if (userProfile.style) {
            showScreen("screen-buyer-feed");
            renderBuyerFeed();
          } else {
            showScreen("screen-buyer-onboarding");
          }
        };
        document.getElementById("btn-delivery").onclick = (e) => {
          addButtonPressEffect(e.target);
          currentUserType = "delivery";
          // Mock: Use a hardcoded ID for demo
          currentDeliveryPersonId = "delivery-dani";

          // For demo purposes, always show the dashboard
          // In a real app, you'd check if the user has completed onboarding
          showScreen("screen-delivery-dashboard");

          // Ensure the dashboard renders properly
          setTimeout(() => {
            renderDeliveryDashboard();
            showToast("Welcome to Delivery Dashboard! 🚚");
          }, 100);
        };

        // Seller Dashboard
        // Event listeners for "Ready for Delivery" are added in renderSellerDashboard

        // Upload Product
        document.getElementById("icon-upload-camera").innerHTML = icons.camera;
        document.getElementById("upload-image-input").onchange = previewImage;
        document.getElementById("btn-generate-desc").onclick =
          handleGenerateDescription;
        document.getElementById("upload-product-form").onsubmit =
          handlePublishProduct;
        document.getElementById("upload-back-btn").onclick = (e) => {
          addButtonPressEffect(e.target);
          // Check if seller has products to determine where to go back
          if (sellerProducts.length === 0) {
            showScreen("screen-welcome");
          } else {
            showScreen("screen-seller-workspace");
            renderSellerWorkspace(sellerProducts);
          }
        };

        // Add real-time form validation
        const form = document.getElementById("upload-product-form");
        const formFields = form.querySelectorAll(".form-input, .form-select");
        formFields.forEach((field) => {
          field.addEventListener("blur", () => validateField(field));
          field.addEventListener("input", () => {
            // Clear error state on input
            if (field.value.trim().length > 0) {
              field.classList.remove("border-red-300", "bg-red-50");
            }
          });
        });

        // Enable publish button when AI description is generated
        document
          .getElementById("btn-generate-desc")
          .addEventListener("click", () => {
            setTimeout(() => {
              if (
                document
                  .getElementById("ai-results-container")
                  .classList.contains("hidden") === false
              ) {
                document.getElementById("btn-publish-product").disabled = false;
              }
            }, 1600);
          });

        // Buyer Onboarding
        document.getElementById("btn-quiz-boho").onclick = (e) => {
          addButtonPressEffect(e.target);
          selectStyleQuiz("Boho");
        };
        document.getElementById("btn-quiz-minimal").onclick = (e) => {
          addButtonPressEffect(e.target);
          selectStyleQuiz("Minimal");
        };
        document.getElementById("btn-quiz-bright").onclick = (e) => {
          addButtonPressEffect(e.target);
          selectStyleQuiz("Bright");
        };
        document.getElementById("btn-quiz-earthy").onclick = (e) => {
          addButtonPressEffect(e.target);
          selectStyleQuiz("Earthy");
        };
        // Mock Instagram connect
        document.getElementById("btn-connect-instagram").onclick = (e) => {
          addButtonPressEffect(e.target);
          document.getElementById("consent-popup").classList.remove("hidden");
        };
        document.getElementById("btn-consent-agree").onclick = (e) => {
          addButtonPressEffect(e.target);
          selectStyleQuiz("Boho"); // Mock: sets style to Boho
          document.getElementById("consent-popup").classList.add("hidden");
        };
        document.getElementById("btn-consent-cancel").onclick = (e) => {
          addButtonPressEffect(e.target);
          document.getElementById("consent-popup").classList.add("hidden");
        };

        // Product Detail
        document.getElementById("btn-buy-product").onclick = (e) => {
          addButtonPressEffect(e.target);
          // Get the selected delivery option
          const deliveryOption = document.querySelector(
            'input[name="product-delivery-option"]:checked'
          );
          if (deliveryOption) {
            // Store the delivery option for the payment modal
            window.selectedDeliveryOption = deliveryOption.value;
          }
          // Open payment modal
          handleBuyProduct(currentProduct.id);
        };
        document.getElementById("detail-back-btn").onclick = (e) => {
          addButtonPressEffect(e.target);
          showScreen("screen-buyer-feed");
        };
        document.getElementById("lang-toggle").onchange = toggleLanguage;

        // Payment Modal
        document.getElementById("payment-backdrop").onclick = () => {
          hideScreen("modal-payment");
        };
        document.getElementById("close-payment-modal").onclick = () => {
          hideScreen("modal-payment");
        };
        document.getElementById("cancel-payment").onclick = () => {
          hideScreen("modal-payment");
        };
        document.getElementById("confirm-purchase").onclick = () => {
          handleCompletePurchase();
        };

        // Update order total when delivery option changes
        document
          .querySelectorAll('input[name="delivery-option"]')
          .forEach((radio) => {
            radio.addEventListener("change", updateOrderTotal);
          });

        // Contact Seller Modal
        document.getElementById("modal-backdrop").onclick = () =>
          hideScreen("modal-contact-seller");
        document.getElementById("btn-copy-number").onclick = (e) => {
          addButtonPressEffect(e.target);
          copySellerNumber();
        };

        // --- Delivery Onboarding ---
        document.getElementById("delivery-photo-input").onchange =
          previewDeliveryImage;
        document.getElementById("delivery-profile-form").onsubmit =
          handleSubmitDeliveryProfile;
        document.getElementById("delivery-onboarding-back-btn").onclick = (
          e
        ) => {
          addButtonPressEffect(e.target);
          showScreen("screen-welcome");
        };
        // Toggle switch logic
        document.getElementById("delivery-status-toggle").onchange = (e) => {
          const label = document.getElementById("delivery-status-label");
          const icon = document.getElementById("delivery-status-icon");
          if (e.target.checked) {
            label.textContent = "Online";
            label.classList.remove("text-gray-500");
            label.classList.add("text-green-600");
            icon.innerHTML = icons.toggleRight;
            icon.classList.remove("text-gray-400");
            icon.classList.add("text-green-600");
          } else {
            label.textContent = "Offline";
            label.classList.remove("text-green-600");
            label.classList.add("text-gray-500");
            icon.innerHTML = icons.toggleLeft;
            icon.classList.remove("text-green-600");
            icon.classList.add("text-gray-400");
          }
        };
        // --- Delivery Dashboard ---
        document.getElementById("delivery-tabs-incoming").onclick = (e) => {
          addButtonPressEffect(e.target);
          document
            .getElementById("delivery-tabs-incoming")
            .classList.add("border-earthy-red", "text-earthy-red");
          document
            .getElementById("delivery-tabs-incoming")
            .classList.remove("border-transparent", "text-charcoal/60");
          document
            .getElementById("delivery-tabs-accepted")
            .classList.add("border-transparent", "text-charcoal/60");
          document
            .getElementById("delivery-tabs-accepted")
            .classList.remove("border-earthy-red", "text-earthy-red");
          document
            .getElementById("delivery-incoming-list")
            .classList.remove("hidden");
          document
            .getElementById("delivery-accepted-list")
            .classList.add("hidden");
        };
        document.getElementById("delivery-tabs-accepted").onclick = (e) => {
          addButtonPressEffect(e.target);
          document
            .getElementById("delivery-tabs-accepted")
            .classList.add("border-earthy-red", "text-earthy-red");
          document
            .getElementById("delivery-tabs-accepted")
            .classList.remove("border-transparent", "text-charcoal/60");
          document
            .getElementById("delivery-tabs-incoming")
            .classList.add("border-transparent", "text-charcoal/60");
          document
            .getElementById("delivery-tabs-incoming")
            .classList.remove("border-earthy-red", "text-earthy-red");
          document
            .getElementById("delivery-accepted-list")
            .classList.remove("hidden");
          document
            .getElementById("delivery-incoming-list")
            .classList.add("hidden");
        };

        // Bottom Nav - Buyer
        document.getElementById("nav-home-buyer").onclick = (e) => {
          addButtonPressEffect(e.target);
          showScreen("screen-buyer-feed");
        };
        document.getElementById("nav-favorites-buyer").onclick = (e) => {
          addButtonPressEffect(e.target);
          showFavoritesScreen();
        };
        document.getElementById("nav-profile-buyer").onclick = (e) => {
          addButtonPressEffect(e.target);
          showScreen("screen-buyer-profile");
        };

        // Bottom Nav - Seller
        document.getElementById("nav-home-seller").onclick = (e) => {
          console.log("Seller home nav clicked"); // Debug log
          addButtonPressEffect(e.target);
          showScreen("screen-seller-workspace");
          renderSellerWorkspace(sellerProducts);
        };
        document.getElementById("nav-upload-seller").onclick = (e) => {
          console.log("Seller upload nav clicked"); // Debug log
          addButtonPressEffect(e.target);
          showScreen("screen-upload-product");
        };
        document.getElementById("nav-profile-seller").onclick = (e) => {
          console.log("Seller profile nav clicked"); // Debug log
          addButtonPressEffect(e.target);
          showScreen("screen-seller-profile");
        };

        // Seller Workspace Event Listeners
        document.getElementById("btn-add-product-workspace").onclick = (e) => {
          addButtonPressEffect(e.target);
          showScreen("screen-upload-product");
        };
        document.getElementById("btn-connect-sellers").onclick = (e) => {
          addButtonPressEffect(e.target);
          showToast("Connect with other sellers feature coming soon! 🤝");
        };
        document.getElementById("back-to-home-seller-workspace").onclick = (
          e
        ) => {
          addButtonPressEffect(e.target);
          showScreen("screen-welcome");
        };

        // --- Bottom Nav - Delivery ---
        document.getElementById("nav-home-delivery").onclick = (e) => {
          addButtonPressEffect(e.target);
          showScreen("screen-delivery-dashboard");
          renderDeliveryDashboard();
        };
        document.getElementById("nav-profile-delivery").onclick = (e) => {
          addButtonPressEffect(e.target);
          showScreen("screen-delivery-onboarding");
          // Populate form with existing data for editing
          if (deliveryProfiles[currentDeliveryPersonId]) {
            const profile = deliveryProfiles[currentDeliveryPersonId];
            document.getElementById("delivery-full-name").value =
              profile.fullName;
            document.getElementById("delivery-location").value =
              profile.location;
            document.getElementById("delivery-id-number").value =
              profile.idNumber;
            document.getElementById("delivery-status-toggle").checked =
              profile.isOnline;
            // Manually trigger change to update UI
            document
              .getElementById("delivery-status-toggle")
              .dispatchEvent(new Event("change"));

            if (profile.photoUrl) {
              const previewContainer = document.getElementById(
                "delivery-image-preview"
              );
              previewContainer.innerHTML = `<img src="${profile.photoUrl}" alt="Preview" class="w-full h-full object-cover rounded-full">`;
            }
            document.getElementById("delivery-onboarding-title").textContent =
              "Edit Your Profile";
            document
              .getElementById("btn-submit-delivery-profile")
              .querySelector(".btn-text").textContent = "Update Profile";
          }
        };
        document.getElementById("delivery-logout-btn").onclick = (e) => {
          addButtonPressEffect(e.target);
          currentUserType = null;
          currentDeliveryPersonId = null;
          showScreen("screen-welcome");
          showToast("You have been logged out.");
        };

        // Set nav icons with emojis for better visual appeal
        document.getElementById("nav-home-buyer").innerHTML = `
                <div class="w-6 h-6 text-2xl">🏠</div>
                <span class="text-xs font-medium">Home</span>
            `;
        document.getElementById("nav-favorites-buyer").innerHTML = `
                <div class="w-6 h-6 text-2xl">❤️</div>
                <span class="text-xs font-medium">Favorites</span>
            `;
        document.getElementById("nav-profile-buyer").innerHTML = `
                <div class="w-6 h-6 text-2xl">👤</div>
                <span class="text-xs font-medium">Profile</span>
            `;

        document.getElementById("nav-home-seller").innerHTML = `
                <div class="w-6 h-6 text-2xl">🏠</div>
                <span class="text-xs font-medium">Home</span>
            `;
        document.getElementById("nav-upload-seller").innerHTML = `
                <div class="w-6 h-6 text-2xl">📸</div>
                <span class="text-xs font-medium">Upload</span>
            `;
        document.getElementById("nav-profile-seller").innerHTML = `
                <div class="w-6 h-6 text-2xl">👤</div>
                <span class="text-xs font-medium">Profile</span>
            `;

        // Delivery Nav Icons
        document.getElementById("nav-home-delivery").innerHTML = `
                <div class="w-6 h-6 text-2xl">🚚</div>
                <span class="text-xs font-medium">Home</span>
            `;
        document.getElementById("nav-profile-delivery").innerHTML = `
                <div class="w-6 h-6 text-2xl">👤</div>
                <span class="text-xs font-medium">Profile</span>
            `;

        // Search and Filter functionality
        document
          .getElementById("search-input")
          .addEventListener("input", (e) => {
            searchQuery = e.target.value;
            renderBuyerFeed();
          });

        // Filter buttons
        document.getElementById("filter-all").onclick = (e) => {
          addButtonPressEffect(e.target);
          setActiveFilter("all");
        };
        document.getElementById("filter-dress").onclick = (e) => {
          addButtonPressEffect(e.target);
          setActiveFilter("dress");
        };
        document.getElementById("filter-top").onclick = (e) => {
          addButtonPressEffect(e.target);
          setActiveFilter("top");
        };
        document.getElementById("filter-bottom").onclick = (e) => {
          addButtonPressEffect(e.target);
          setActiveFilter("bottom");
        };
        document.getElementById("filter-accessories").onclick = (e) => {
          addButtonPressEffect(e.target);
          setActiveFilter("accessories");
        };

        // Back buttons
        document.getElementById("back-to-home").onclick = (e) => {
          addButtonPressEffect(e.target);
          showScreen("screen-welcome");
        };
        document.getElementById("back-to-home-seller").onclick = (e) => {
          addButtonPressEffect(e.target);
          showScreen("screen-welcome");
        };
        document.getElementById("back-to-home-buyer").onclick = (e) => {
          addButtonPressEffect(e.target);
          showScreen("screen-welcome");
        };

        // Profile back buttons
        document.getElementById("back-to-feed").onclick = (e) => {
          addButtonPressEffect(e.target);
          showScreen("screen-buyer-feed");
        };
        document.getElementById("back-to-dashboard").onclick = (e) => {
          addButtonPressEffect(e.target);
          showScreen("screen-seller-dashboard");
        };
      }

      /**
       * Controls screen visibility
       * @param {string} screenId The ID of the screen to show
       */
      function showScreen(screenId) {
        // Hide all screens and modals
        document
          .querySelectorAll(".app-screen, .app-modal")
          .forEach((screen) => {
            if (!screen.classList.contains("app-modal")) {
              screen.classList.add("hidden");
            }
          });

        // Show the target screen
        const targetScreen = document.getElementById(screenId);
        if (targetScreen) {
          targetScreen.classList.remove("hidden");
        }

        // Show/hide bottom nav based on screen and user type
        const buyerNav = document.getElementById("bottom-nav-buyer");
        const sellerNav = document.getElementById("bottom-nav-seller");
        const deliveryNav = document.getElementById("bottom-nav-delivery");

        buyerNav.classList.add("hidden");
        sellerNav.classList.add("hidden");
        deliveryNav.classList.add("hidden");

        if (
          currentUserType === "buyer" &&
          (screenId.startsWith("screen-buyer") ||
            screenId.startsWith("screen-product-detail"))
        ) {
          buyerNav.classList.remove("hidden");
        } else if (
          currentUserType === "seller" &&
          (screenId.startsWith("screen-seller") ||
            screenId.startsWith("screen-upload-product"))
        ) {
          sellerNav.classList.remove("hidden");
          console.log("Showing seller nav for:", screenId); // Debug log
        } else if (
          currentUserType === "delivery" &&
          screenId.startsWith("screen-delivery")
        ) {
          deliveryNav.classList.remove("hidden");
        }

        // Update active state in navigation
        updateActiveNavState(screenId);
      }

      /**
       * Update active state in navigation
       * @param {string} screenId The ID of the current screen
       */
      function updateActiveNavState(screenId) {
        // Reset all active states
        document.querySelectorAll(".nav-item").forEach((item) => {
          item.classList.remove("text-earthy-red", "active");
          item.classList.add("text-charcoal/60");
        });

        // Set active state based on current screen
        let activeNavId = null;

        if (currentUserType === "seller") {
          if (
            screenId === "screen-seller-dashboard" ||
            screenId === "screen-seller-workspace"
          )
            activeNavId = "nav-home-seller";
          else if (screenId === "screen-upload-product")
            activeNavId = "nav-upload-seller";
          else if (screenId === "screen-seller-profile")
            activeNavId = "nav-profile-seller";
        } else if (currentUserType === "buyer") {
          if (screenId === "screen-buyer-feed") activeNavId = "nav-home-buyer";
          else if (screenId === "screen-product-detail")
            activeNavId =
              "nav-home-buyer"; // Keep home active for product detail
          // Note: Favorites screen re-uses buyer-feed, so 'nav-favorites-buyer' is handled by its click handler
          else if (screenId === "screen-buyer-profile")
            activeNavId = "nav-profile-buyer";
        } else if (currentUserType === "delivery") {
          if (screenId === "screen-delivery-dashboard")
            activeNavId = "nav-home-delivery";
          else if (screenId === "screen-delivery-onboarding")
            activeNavId = "nav-profile-delivery";
        }

        if (activeNavId) {
          const navBtn = document.getElementById(activeNavId);
          if (navBtn) {
            navBtn.classList.add("text-earthy-red", "active");
            navBtn.classList.remove("text-charcoal/60");
          }
        }
      }

      /**
       * Hides a modal overlay
       * @param {string} modalId The ID of the modal to hide
       */
      function hideScreen(modalId) {
        const targetScreen = document.getElementById(modalId);
        if (targetScreen) {
          targetScreen.classList.add("hidden");
        }
      }

      // --- DATA & STATE ---

      /**
       * Save the buyer's chosen style (COMMENTED OUT)
       * @param {string} style The style selected (e.g., 'Boho')
       */
      async function selectStyleQuiz(style) {
        userProfile = { ...userProfile, style: style };
        showToast(`Style set to ${style}!`);
        showScreen("screen-buyer-feed");
        renderBuyerFeed();
      }

      // --- RENDER FUNCTIONS ---

      /**
       * Render the seller's dashboard with their products
       * @param {Array} sellerProducts Array of the seller's product objects
       */
      function renderSellerDashboard(sellerProducts = []) {
        const container = document.getElementById("seller-products-grid");

        if (sellerProducts.length === 0) {
          container.innerHTML = `<p class="text-charcoal/70 text-center col-span-2">You haven't uploaded any products yet. Tap the + button to get started!</p>`;
          return;
        }

        container.innerHTML = sellerProducts
          .map((product) => {
            let deliveryButtonHtml = "";
            const job = deliveryJobs.find((j) => j.productId === product.id);

            if (job) {
              switch (job.status) {
                case "pending":
                  deliveryButtonHtml = `<button class="btn-outline w-full text-sm mt-2" disabled>Awaiting Pickup</button>`;
                  break;
                case "accepted":
                case "on_the_way":
                  deliveryButtonHtml = `<button class="btn-outline w-full text-sm mt-2 border-blue-500 text-blue-500" disabled>Out for Delivery</button>`;
                  break;
                case "delivered":
                  deliveryButtonHtml = `<button class="btn-outline w-full text-sm mt-2 border-green-500 text-green-500" disabled>Delivered</button>`;
                  break;
                default:
                  deliveryButtonHtml = `<button class="btn-primary w-full text-sm mt-2" onclick="window.handleBuyProduct('${product.id}')">🛒 Buy Now</button>`;
              }
            } else {
              // Show Buy Now button for products without delivery status
              deliveryButtonHtml = `<button class="btn-primary w-full text-sm mt-2" onclick="window.handleBuyProduct('${product.id}')">🛒 Buy Now</button>`;
            }

            return `
                <div class="bg-white rounded-xl shadow-sm overflow-hidden flex flex-col justify-between">
                    <div>
                        <img src="${product.imageUrl}" alt="${
              product.title
            }" class="w-full h-40 object-cover">
                    <div class="p-3">
                            <h3 class="font-semibold text-charcoal truncate">${
                              product.title
                            }</h3>
                            <p class="text-earthy-red font-medium">${
                              product.price
                            } ETB</p>
                        <div class="flex items-center text-charcoal/60 text-sm mt-2 gap-4">
                                <span class="flex items-center gap-1">${
                                  icons.eye
                                } ${product.views || 0}</span>
                                <span class="flex items-center gap-1">${
                                  icons.message
                                } ${product.contacts || 0}</span>
                        </div>
                    </div>
                </div>
                    <div class="p-3 pt-0">
                        ${deliveryButtonHtml}
                    </div>
                </div>
            `;
          })
          .join("");
      }

      /**
       * Render the seller's workspace with their products (NO BUY OPTIONS)
       * @param {Array} sellerProducts Array of the seller's product objects
       */
      function renderSellerWorkspace(sellerProducts = []) {
        const container = document.getElementById("seller-workspace-grid");

        // Update stats
        const productsCount = document.getElementById(
          "workspace-products-count"
        );
        const viewsCount = document.getElementById("workspace-views-count");
        const connectionsCount = document.getElementById(
          "workspace-connections-count"
        );

        if (productsCount) {
          productsCount.textContent = sellerProducts.length;
        }
        if (viewsCount) {
          const totalViews = sellerProducts.reduce(
            (sum, p) => sum + (p.views || 0),
            0
          );
          viewsCount.textContent = totalViews.toLocaleString();
        }
        if (connectionsCount) {
          connectionsCount.textContent = "0"; // Mock connections count
        }

        if (sellerProducts.length === 0) {
          container.innerHTML = `
            <div class="col-span-2 bg-white rounded-xl p-8 text-center shadow-sm">
              <div class="text-6xl mb-4">📸</div>
              <h3 class="text-lg font-semibold text-charcoal mb-2">No Products Yet</h3>
              <p class="text-charcoal/70 mb-4">Start building your workspace by adding your first product!</p>
              <button 
                id="btn-start-upload"
                class="btn-primary"
                onclick="showScreen('screen-upload-product')"
              >
                Add Your First Product
              </button>
            </div>
          `;
          return;
        }

        container.innerHTML = sellerProducts
          .map((product) => {
            return `
                <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                <div>
                    <img src="${product.imageUrl}" alt="${
              product.title
            }" class="w-full h-40 object-cover">
                    <div class="p-3">
                        <h3 class="font-semibold text-charcoal truncate">${
                          product.title
                        }</h3>
                        <p class="text-earthy-red font-medium">${
                          product.price
                        } ETB</p>
                        <div class="flex items-center text-charcoal/60 text-sm mt-2 gap-4">
                      <span class="flex items-center gap-1">👁️ ${
                        product.views || 0
                      }</span>
                      <span class="flex items-center gap-1">💬 ${
                        product.contacts || 0
                      }</span>
                        </div>
                    </div>
                </div>
                <div class="p-3 pt-0">
                  <button 
                    class="btn-outline w-full text-sm"
                    onclick="editProduct('${product.id}')"
                  >
                    ✏️ Edit Product
                  </button>
                </div>
              </div>
            `;
          })
          .join("");
      }

      /**
       * Filter products based on search query and category filter
       */
      function filterProducts(products) {
        let filtered = products;

        // Apply search filter
        if (searchQuery.trim()) {
          const query = searchQuery.toLowerCase();
          filtered = filtered.filter(
            (product) =>
              product.title.toLowerCase().includes(query) ||
              product.descriptionEN.toLowerCase().includes(query) ||
              product.tags.some((tag) => tag.toLowerCase().includes(query))
          );
        }

        // Apply category filter
        if (currentFilter !== "all") {
          filtered = filtered.filter(
            (product) =>
              product.category &&
              product.category.toLowerCase() === currentFilter.toLowerCase()
          );
        }

        return filtered;
      }

      /**
       * Render the buyer's personalized feed
       */
      function renderBuyerFeed() {
        const container = document.getElementById("buyer-feed-grid");

        // Filter products first
        const filteredProducts = filterProducts(allProducts);

        if (filteredProducts.length === 0) {
          const message =
            searchQuery || currentFilter !== "all"
              ? `No products found matching your criteria.`
              : `No products available right now. Check back soon!`;
          container.innerHTML = `<p class="text-charcoal/70 text-center col-span-2">${message}</p>`;
          return;
        }

        // Calculate match score and sort
        const scoredProducts = filteredProducts
          .map((product) => {
            let matchScore = 20; // Base score
            let reason = [];

            if (userProfile.style) {
              if (product.style && product.style === userProfile.style) {
                matchScore += 60;
                reason.push(`Style: ${product.style}`);
              }
              if (
                product.tags &&
                product.tags.includes(userProfile.style.toLowerCase())
              ) {
                matchScore += 15;
              }
            }

            // Clamp score
            matchScore = Math.min(
              Math.floor(matchScore * (1 + Math.random() * 0.2)),
              98
            ); // Add some fuzziness

            return { ...product, matchScore, reason: reason.join(", ") };
          })
          .sort((a, b) => b.matchScore - a.matchScore);

        container.innerHTML = scoredProducts
          .map((product) => {
            const isFavorite = favoriteProducts.includes(product.id);
            return `
                    <div class="bg-white rounded-xl shadow-sm overflow-hidden hover:shadow-lg transition-shadow duration-200" onclick="window.showProductDetail('${
                      product.id
                    }')">
                    <div class="relative">
                        <img src="${product.imageUrl}" alt="${
              product.title
            }" class="w-full h-48 object-cover">
                        <span class="absolute top-2 left-2 bg-black/50 text-white text-xs font-semibold px-2 py-1 rounded-full">Match ${
                          product.matchScore
                        }%</span>
                            <button class="absolute top-2 right-2 w-8 h-8 bg-white/90 rounded-full flex items-center justify-center hover:bg-white transition-colors" onclick="event.stopPropagation(); window.toggleFavorite('${
                              product.id
                            }')" aria-label="${
              isFavorite ? "Remove from favorites" : "Add to favorites"
            }">
                                <svg class="w-4 h-4 ${
                                  isFavorite
                                    ? "text-red-500 fill-current"
                                    : "text-gray-400"
                                }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                                </svg>
                            </button>
                    </div>
                    <div class="p-3">
                        <h3 class="font-semibold text-charcoal truncate">${
                          product.title
                        }</h3>
                        <p class="text-earthy-red font-medium">${
                          product.price
                        } ETB</p>
                        ${
                          product.reason
                            ? `<p class="text-charcoal/60 text-xs mt-1">${product.reason}</p>`
                            : ""
                        }
                    </div>
                </div>
                `;
          })
          .join("");
      }

      /**
       * Render the delivery person's dashboard
       */
      function renderDeliveryDashboard() {
        const incomingList = document.getElementById("delivery-incoming-list");
        const acceptedList = document.getElementById("delivery-accepted-list");

        const incomingJobs = deliveryJobs.filter(
          (job) => job.status === "pending"
        );
        const acceptedJobs = deliveryJobs.filter(
          (job) =>
            job.deliveryId === currentDeliveryPersonId &&
            (job.status === "accepted" ||
              job.status === "on_the_way" ||
              job.status === "delivered")
        );

        // Render Incoming Jobs
        if (incomingJobs.length === 0) {
          incomingList.innerHTML = `<p class="text-charcoal/70 text-center col-span-2 p-4">No incoming requests right now. Stay tuned!</p>`;
        } else {
          incomingList.innerHTML = incomingJobs
            .map((job) => {
              const product = allProducts.find((p) => p.id === job.productId);
              return `
                        <div class="bg-white rounded-xl shadow-sm overflow-hidden p-4">
                            <div class="flex gap-4">
                                <img src="${product.imageUrl}" alt="${product.title}" class="w-20 h-20 object-cover rounded-lg">
                                <div class="flex-1">
                                    <h4 class="font-semibold text-charcoal">${product.title}</h4>
                                    <p class="text-sm text-charcoal/70">From: ${job.pickupLocation}</p>
                                    <p class="text-sm text-charcoal/70">To: ${job.dropoffLocation}</p>
                                    <p class="text-lg font-bold text-earthy-red mt-1">Fee: ${job.deliveryFee} ETB</p>
                                </div>
                            </div>
                            <button class="btn-primary w-full text-sm mt-3" onclick="window.handleAcceptDelivery('${job.id}')">
                                Accept Job
                            </button>
                        </div>
                    `;
            })
            .join("");
        }

        // Render Accepted Jobs
        if (acceptedJobs.length === 0) {
          acceptedList.innerHTML = `<p class="text-charcoal/70 text-center col-span-2 p-4">You have no active deliveries.</p>`;
        } else {
          acceptedList.innerHTML = acceptedJobs
            .map((job) => {
              const product = allProducts.find((p) => p.id === job.productId);
              let statusHtml = "";

              switch (job.status) {
                case "accepted":
                  statusHtml = `<button class="btn-secondary w-full text-sm mt-3" onclick="window.handleUpdateDeliveryStatus('${job.jobId}', 'on_the_way')">
                                Mark as "On the Way"
                            </button>`;
                  break;
                case "on_the_way":
                  statusHtml = `<button class="btn-primary w-full text-sm mt-3" onclick="window.handleUpdateDeliveryStatus('${job.jobId}', 'delivered')">
                                Mark as "Delivered"
                            </button>`;
                  break;
                case "delivered":
                  statusHtml = `<div class="w-full text-center text-sm mt-3 p-3 bg-green-100 text-green-700 font-semibold rounded-lg">
                                ✅ Successfully Delivered
                            </div>`;
                  break;
              }

              return `
                        <div class="bg-white rounded-xl shadow-sm overflow-hidden p-4">
                            <div class="flex gap-4">
                                <img src="${product.imageUrl}" alt="${
                product.title
              }" class="w-20 h-20 object-cover rounded-lg">
                                <div class="flex-1">
                                    <h4 class="font-semibold text-charcoal">${
                                      product.title
                                    }</h4>
                                    <p class="text-sm text-charcoal/70">From: ${
                                      job.pickupLocation
                                    }</p>
                                    <p class="text-sm text-charcoal/70">To: ${
                                      job.dropoffLocation
                                    }</p>
                                    <p class="text-lg font-bold text-earthy-red mt-1">Status: <span class="capitalize">${job.status.replace(
                                      "_",
                                      " "
                                    )}</span></p>
                                </div>
                            </div>
                            ${statusHtml}
                        </div>
                    `;
            })
            .join("");
        }
      }

      /**
       * Toggle favorite status for a product
       * @param {string} productId The ID of the product to toggle
       */
      window.toggleFavorite = (productId) => {
        const index = favoriteProducts.indexOf(productId);
        if (index > -1) {
          favoriteProducts.splice(index, 1);
          showToast("Removed from favorites");
        } else {
          favoriteProducts.push(productId);
          showToast("Added to favorites ❤️");
        }

        // Re-render the feed to update heart icons
        if (currentUserType === "buyer") {
          renderBuyerFeed();
        }
      };

      /**
       * Show the product detail screen
       * @param {string} productId The ID of the product to show
       */
      window.showProductDetail = (productId) => {
        currentProduct = allProducts.find((p) => p.id === productId);
        if (!currentProduct) return;

        document.getElementById("detail-image").src = currentProduct.imageUrl;
        document.getElementById("detail-image").alt = currentProduct.title;
        document.getElementById("detail-title").innerText =
          currentProduct.title;
        document.getElementById(
          "detail-price"
        ).innerText = `${currentProduct.price} ETB`;

        document.getElementById("detail-tags").innerHTML = (
          currentProduct.tags || []
        )
          .map(
            (tag) => `
                <span class="bg-blush text-earthy-red text-sm font-medium px-3 py-1 rounded-full">${tag}</span>
            `
          )
          .join("");

        document.getElementById("detail-desc-en").innerText =
          currentProduct.descriptionEN || "No description available.";
        document.getElementById("detail-desc-am").innerText =
          currentProduct.descriptionAM || "תיאור לא זמין."; // Placeholder Amharic

        // Set up contact modal
        document.getElementById("contact-seller-name").innerText =
          "Amina Kebebe"; // Hardcoded seller
        document.getElementById("contact-seller-phone").innerText =
          "+251 91 234 5678";
        const message = `Hi! I loved your ${currentProduct.title} on HerSpotlight — is it available?`;
        document.getElementById(
          "contact-whatsapp-link"
        ).href = `https://wa.me/251912345678?text=${encodeURIComponent(
          message
        )}`;

        // --- Show Delivery Status ---
        const deliveryStatusContainer = document.getElementById(
          "delivery-status-container"
        );
        const job = deliveryJobs.find((j) => j.productId === productId);

        if (
          job &&
          (job.status === "accepted" ||
            job.status === "on_the_way" ||
            job.status === "delivered")
        ) {
          const deliveryPerson = deliveryProfiles[job.deliveryId];
          if (deliveryPerson) {
            let statusText = "";
            if (job.status === "accepted") statusText = "Preparing for pickup";
            if (job.status === "on_the_way") statusText = "On the way to you!";
            if (job.status === "delivered") statusText = "Delivered!";

            deliveryStatusContainer.innerHTML = `
                        <h4 class="text-lg font-semibold text-charcoal mb-3">Delivery Status</h4>
                        <div class="bg-white rounded-2xl p-4 flex items-center gap-4 shadow-sm">
                            <img src="${deliveryPerson.photoUrl}" alt="${
              deliveryPerson.fullName
            }" class="w-16 h-16 rounded-full border-2 border-blush">
                            <div>
                                <p class="font-semibold text-charcoal">${
                                  deliveryPerson.fullName
                                }</p>
                                <p class="text-charcoal/70">Your delivery driver</p>
                                <p class="text-lg font-bold ${
                                  job.status === "delivered"
                                    ? "text-green-600"
                                    : "text-earthy-red"
                                } mt-1">${statusText}</p>
                            </div>
                        </div>
                    `;
            deliveryStatusContainer.classList.remove("hidden");
          }
        } else {
          deliveryStatusContainer.classList.add("hidden");
          deliveryStatusContainer.innerHTML = ""; // Clear it
        }

        showScreen("screen-product-detail");
      };

      /**
       * Toggle between English and Amharic descriptions
       */
      function toggleLanguage() {
        const isChecked = document.getElementById("lang-toggle").checked;
        if (isChecked) {
          // Show Amharic
          document.getElementById("detail-desc-en").classList.add("hidden");
          document.getElementById("detail-desc-am").classList.remove("hidden");
        } else {
          // Show English
          document.getElementById("detail-desc-en").classList.remove("hidden");
          document.getElementById("detail-desc-am").classList.add("hidden");
        }
      }

      // --- FORM HANDLERS & API CALLS ---

      /**
       * Show a preview of the selected image
       * @param {Event} event The file input change event
       */
      function previewImage(event) {
        const file = event.target.files[0];
        if (file) {
          // Validate file type
          if (!file.type.startsWith("image/")) {
            showToast("Please select a valid image file.", true);
            event.target.value = "";
            return;
          }

          // Validate file size (max 5MB)
          if (file.size > 5 * 1024 * 1024) {
            showToast("Image size must be less than 5MB.", true);
            event.target.value = "";
            return;
          }

          const reader = new FileReader();
          reader.onload = (e) => {
            const previewContainer = document.getElementById(
              "image-preview-container"
            );
            previewContainer.innerHTML = `
                        <img src="${e.target.result}" alt="Preview" class="w-full h-full object-cover rounded-xl">
                        <button type="button" onclick="removeImagePreview('image-preview-container', 'upload-image-input')" class="absolute top-2 right-2 w-8 h-8 bg-red-500 text-white rounded-full flex items-center justify-center hover:bg-red-600 transition-colors" aria-label="Remove image">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    `;
            previewContainer.classList.add("relative");
          };
          reader.readAsDataURL(file);
          showToast("Image uploaded successfully!");
        }
      }

      /**
       * Show preview for delivery person photo
       */
      function previewDeliveryImage(event) {
        const file = event.target.files[0];
        if (file) {
          if (!file.type.startsWith("image/")) {
            showToast("Please select a valid image file.", true);
            event.target.value = "";
            return;
          }
          if (file.size > 5 * 1024 * 1024) {
            showToast("Image size must be less than 5MB.", true);
            event.target.value = "";
            return;
          }

          const reader = new FileReader();
          reader.onload = (e) => {
            const previewContainer = document.getElementById(
              "delivery-image-preview"
            );
            previewContainer.innerHTML = `
                        <img src="${e.target.result}" alt="Preview" class="w-full h-full object-cover rounded-full">
                        <button type="button" onclick="removeImagePreview('delivery-image-preview', 'delivery-photo-input')" class="absolute bottom-0 right-0 w-8 h-8 bg-red-500 text-white rounded-full flex items-center justify-center hover:bg-red-600 transition-colors" aria-label="Remove image">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    `;
          };
          reader.readAsDataURL(file);
        }
      }

      /**
       * Remove image preview
       * @param {string} previewId The ID of the preview container
       * @param {string} inputId The ID of the file input
       */
      window.removeImagePreview = (previewId, inputId) => {
        document.getElementById(previewId).innerHTML = "";
        document.getElementById(inputId).value = "";
        showToast("Image removed");

        // Reset delivery preview to default
        if (previewId === "delivery-image-preview") {
          document.getElementById(
            previewId
          ).innerHTML = `<span class="text-3xl text-charcoal/60">${icons.camera}</span>`;
        }
      };

      /**
       * Handle the "Generate Description" button click
       */
      async function handleGenerateDescription() {
        const btn = document.getElementById("btn-generate-desc");
        const loader = btn.querySelector(".loader");
        const icon = btn.querySelector(".icon");

        // Get form data
        const category = document.getElementById("upload-category").value;
        const color = document.getElementById("upload-color").value;
        const notes = document.getElementById("upload-notes").value;

        // Validate required fields
        if (!category || !color || !notes) {
          showToast("Please fill in Category, Color, and Notes first.", true);

          // Highlight invalid fields
          if (!category)
            validateField(document.getElementById("upload-category"));
          if (!color) validateField(document.getElementById("upload-color"));
          if (!notes) validateField(document.getElementById("upload-notes"));

          return;
        }

        try {
          // Show loading state
          setButtonLoading(btn, true);
          loader.classList.remove("hidden");
          icon.classList.add("hidden");

          // Mock AI response for demo
          await new Promise((resolve) => setTimeout(resolve, 1500));

          // Mock AI data
          const aiData = {
            descriptionEN: `Beautiful ${category} in ${color} color. ${notes}`,
            descriptionAM: `ውብ ${category} በ${color} ቀለም. ${notes}`,
            tags: ["Handmade", "AddisAbaba", "Cultural"],
            style: "Boho",
          };

          // Populate the form
          document.getElementById("ai-generated-en").innerText =
            aiData.descriptionEN;
          document.getElementById("ai-generated-am").innerText =
            aiData.descriptionAM;
          document.getElementById("ai-tags-container").innerHTML = aiData.tags
            .map(
              (tag) =>
                `<span class="bg-blush text-earthy-red text-sm font-medium px-3 py-1 rounded-full">${tag}</span>`
            )
            .join("");

          // Store hidden AI data
          document.getElementById("hidden-desc-en").value =
            aiData.descriptionEN;
          document.getElementById("hidden-desc-am").value =
            aiData.descriptionAM;
          document.getElementById("hidden-tags").value = JSON.stringify(
            aiData.tags
          );
          document.getElementById("hidden-style").value = aiData.style;

          document
            .getElementById("ai-results-container")
            .classList.remove("hidden");
          document.getElementById("btn-publish-product").disabled = false;

          showToast("Description generated successfully!");
        } catch (error) {
          console.error("Error generating description:", error);
          showToast("Failed to generate description. Please try again.", true);
        } finally {
          // Hide loading state
          setButtonLoading(btn, false);
          loader.classList.add("hidden");
          icon.classList.remove("hidden");
        }
      }

      /**
       * Handle publishing the new product
       * @param {Event} event The form submit event
       */
      async function handlePublishProduct(event) {
        event.preventDefault();
        const btn = document.getElementById("btn-publish-product");
        const form = event.target;

        // Validate form before submission
        if (!validateForm(form)) {
          showToast("Please fill in all required fields.", true);
          return;
        }

        try {
          // Show loading state
          setButtonLoading(btn, true);
          btn.querySelector(".btn-text").textContent = "Publishing...";

          const category = form.category.value;
          const newTitle = form.title.value;

          // Create new product object
          const newProduct = {
            id: Date.now().toString(), // Simple ID generation
            title: newTitle,
            category: category,
            size: form.size.value,
            color: form.color.value,
            price: Number(form.price.value),
            location: form.location.value,
            notes: form.notes.value,
            descriptionEN: form["hidden-desc-en"].value,
            descriptionAM: form["hidden-desc-am"].value,
            tags: JSON.parse(form["hidden-tags"].value),
            style: form["hidden-style"].value,
            imageUrl: `https://placehold.co/600x600/F9DAD0/333333?text=${encodeURIComponent(
              newTitle
            )}`,
            views: 0,
            contacts: 0,
            sellerId: "seller-amina", // Hardcoded seller ID
            deliveryStatus: "none",
          };

          // Simulate API call delay
          await new Promise((resolve) => setTimeout(resolve, 1000));

          // Add to seller's products and all products list
          sellerProducts.push(newProduct);
          allProducts.push(newProduct);

          showToast("Your product is live! 🚀");

          // Reset form
          form.reset();
          removeImagePreview("image-preview-container", "upload-image-input");
          document
            .getElementById("ai-results-container")
            .classList.add("hidden");
          document.getElementById("btn-publish-product").disabled = true;

          // Reset form field validation states
          form
            .querySelectorAll(".form-input, .form-select")
            .forEach((field) => {
              field.classList.remove(
                "border-red-300",
                "bg-red-50",
                "border-green-300",
                "bg-green-50"
              );
            });

          // Navigate back to workspace and render updated products
          showScreen("screen-seller-workspace");
          renderSellerWorkspace(sellerProducts);
        } catch (error) {
          console.error("Error publishing product:", error);
          showToast("Could not publish product. Please try again.", true);
        } finally {
          setButtonLoading(btn, false);
          btn.querySelector(".btn-text").textContent = "Publish Product";
        }
      }

      // --- DELIVERY HANDLERS ---

      /**
       * Handle seller marking an item as "Ready for Delivery"
       * @param {string} productId The ID of the product
       */
      window.handleReadyForDelivery = (productId) => {
        const product = allProducts.find((p) => p.id === productId);
        if (!product) return;

        // Create a new mock delivery job
        const newJob = {
          jobId: `job-${Date.now()}`,
          productId: product.id,
          sellerId: product.sellerId,
          buyerId: userProfile.buyerId, // Mock buyer ID
          deliveryId: null, // Unassigned
          status: "pending", // 'pending', 'accepted', 'on_the_way', 'delivered'
          pickupLocation: product.location, // From product
          dropoffLocation: "Bole, Addis Ababa", // Mock buyer location
          deliveryFee: 150, // Mock fee
          createdAt: new Date().toISOString(),
        };

        // Add to our mock DB
        deliveryJobs.push(newJob);

        // Update product status (for UI)
        product.deliveryStatus = "pending";

        showToast("Delivery request sent!");

        // Re-render seller dashboard to show "Awaiting Pickup"
        renderSellerDashboard(sellerProducts);
      };

      /**
       * Handle delivery person accepting a job
       * @param {string} jobId The ID of the job to accept
       */
      window.handleAcceptDelivery = (jobId) => {
        const job = deliveryJobs.find((j) => j.id === jobId);
        if (!job) return;

        job.status = "accepted";
        job.deliveryId = currentDeliveryPersonId; // Assign self to job

        // Update product status
        const product = allProducts.find((p) => p.id === job.productId);
        if (product) {
          product.deliveryStatus = "accepted";
        }

        showToast("Job accepted! Head to pickup.");

        // Re-render dashboard
        renderDeliveryDashboard();

        // Re-render seller dashboard if active (to show "Out for Delivery")
        if (currentUserType === "seller") {
          renderSellerDashboard(sellerProducts);
        }
      };

      /**
       * Handle delivery person updating job status
       * @param {string} jobId The ID of the job
       * @param {string} newStatus The new status ('on_the_way' or 'delivered')
       */
      window.handleUpdateDeliveryStatus = (jobId, newStatus) => {
        const job = deliveryJobs.find((j) => j.jobId === jobId);
        if (!job) return;

        job.status = newStatus;

        // Update product status
        const product = allProducts.find((p) => p.id === job.productId);
        if (product) {
          product.deliveryStatus = newStatus;
        }

        if (newStatus === "on_the_way") {
          showToast("Status updated: On the Way!");
        } else if (newStatus === "delivered") {
          showToast("Delivery complete! 🎉");
        }

        // Re-render dashboard
        renderDeliveryDashboard();
      };

      /**
       * Handle submission of the delivery profile form
       * @param {Event} event The form submit event
       */
      async function handleSubmitDeliveryProfile(event) {
        event.preventDefault();
        const btn = document.getElementById("btn-submit-delivery-profile");
        const form = event.target;

        // Validate form
        if (!validateForm(form)) {
          showToast("Please fill in all required fields.", true);
          return;
        }

        setButtonLoading(btn, true);

        // Mock image URL (in a real app, you'd upload this)
        const photoPreview = document
          .getElementById("delivery-image-preview")
          .querySelector("img");
        const mockPhotoUrl = photoPreview
          ? photoPreview.src
          : "https://placehold.co/100x100/F9DAD0/333333?text=Driver";

        // Create/update profile in mock DB
        deliveryProfiles[currentDeliveryPersonId] = {
          id: currentDeliveryPersonId,
          fullName: form["delivery-full-name"].value,
          location: form["delivery-location"].value,
          idNumber: form["delivery-id-number"].value,
          isOnline: form["delivery-status-toggle"].checked,
          photoUrl: mockPhotoUrl,
        };

        // Simulate save
        await new Promise((resolve) => setTimeout(resolve, 1000));

        setButtonLoading(btn, false);
        showToast("Profile saved successfully!");

        // Reset button text in case it was "Update"
        document.getElementById("delivery-onboarding-title").textContent =
          "Create Your Delivery Profile";
        document
          .getElementById("btn-submit-delivery-profile")
          .querySelector(".btn-text").textContent = "Submit Profile";

        showScreen("screen-delivery-dashboard");
        renderDeliveryDashboard();
      }

      // --- UTILITY FUNCTIONS ---

      /**
       * Add visual feedback for button press
       * @param {HTMLElement} button The button element
       */
      function addButtonPressEffect(button) {
        if (!button) return;
        button.classList.add("btn-press-animation");
        setTimeout(() => {
          button.classList.remove("btn-press-animation");
        }, 100);
      }

      /**
       * Set button loading state
       * @param {HTMLElement} button The button element
       * @param {boolean} isLoading Whether to show loading state
       */
      function setButtonLoading(button, isLoading) {
        if (!button) return;
        const textEl = button.querySelector(".btn-text");
        const spinnerEl = button.querySelector(".btn-spinner, .loader");

        if (isLoading) {
          button.classList.add("btn-loading");
          button.disabled = true;
          if (textEl) textEl.classList.add("opacity-50");
          if (spinnerEl) spinnerEl.classList.remove("hidden");
        } else {
          button.classList.remove("btn-loading");
          button.disabled = false;
          if (textEl) textEl.classList.remove("opacity-50");
          if (spinnerEl) spinnerEl.classList.add("hidden");
        }
      }

      /**
       * Validate form field
       * @param {HTMLElement} field The form field element
       * @returns {boolean} Whether the field is valid
       */
      function validateField(field) {
        if (!field) return false;

        const value = field.value.trim();
        const isValid = value.length > 0;

        if (field.type === "file" && field.files.length > 0) {
          // Special handling for file input (already validated on change)
          return true;
        }

        if (isValid) {
          field.classList.remove("border-red-300", "bg-red-50");
          field.classList.add("border-green-300", "bg-green-50");
        } else {
          field.classList.remove("border-green-300", "bg-green-50");
          field.classList.add("border-red-300", "bg-red-50");
        }

        return isValid;
      }

      /**
       * Validate entire form
       * @param {HTMLElement} form The form element
       * @returns {boolean} Whether the form is valid
       */
      function validateForm(form) {
        if (!form) return false;
        const requiredFields = form.querySelectorAll("[required]");
        let isValid = true;

        requiredFields.forEach((field) => {
          if (!validateField(field)) {
            isValid = false;
          }
        });

        // Special check for image upload
        if (
          form.id === "upload-product-form" &&
          !document.getElementById("upload-image-input").files.length > 0
        ) {
          isValid = false;
          showToast("Please upload a product image.", true);
        }

        if (
          form.id === "delivery-profile-form" &&
          !document.getElementById("delivery-photo-input").files.length > 0
        ) {
          // Allow editing profile without re-uploading photo if one exists
          if (
            !deliveryProfiles[currentDeliveryPersonId] ||
            !deliveryProfiles[currentDeliveryPersonId].photoUrl
          ) {
            isValid = false;
            showToast("Please upload a profile photo.", true);
          }
        }

        return isValid;
      }

      /**
       * Set active filter and update UI
       * @param {string} filter The filter to set as active
       */
      function setActiveFilter(filter) {
        currentFilter = filter;

        // Update filter button states
        document.querySelectorAll('[id^="filter-"]').forEach((btn) => {
          btn.classList.remove("active", "bg-earthy-red", "text-white");
          btn.classList.add("bg-transparent", "text-earthy-red");
        });

        const activeBtn = document.getElementById(`filter-${filter}`);
        if (activeBtn) {
          activeBtn.classList.add("active", "bg-earthy-red", "text-white");
          activeBtn.classList.remove("bg-transparent", "text-earthy-red");
        }

        // Re-render the feed
        renderBuyerFeed();
      }

      /**
       * Copies the seller's number to the clipboard
       */
      async function copySellerNumber() {
        const number = document.getElementById(
          "contact-seller-phone"
        ).innerText;

        try {
          // Use modern clipboard API if available
          if (navigator.clipboard && window.isSecureContext) {
            await navigator.clipboard.writeText(number);
            showToast("Phone number copied!");
          } else {
            // Fallback for older browsers
            const textarea = document.createElement("textarea");
            textarea.value = number;
            textarea.style.position = "fixed";
            textarea.style.opacity = "0";
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand("copy");
            document.body.removeChild(textarea);
            showToast("Phone number copied!");
          }
        } catch (err) {
          console.error("Failed to copy text: ", err);
          showToast("Could not copy number.", true);
        }
      }

      /**
       * Show a toast message
       * @param {string} message The message to display
       * @param {boolean} [isError=false] Whether this is an error toast
       */
      function showToast(message, isError = false) {
        const toast = document.getElementById("toast");
        toast.innerText = message;

        if (isError) {
          toast.classList.replace("bg-blush", "bg-red-500");
          toast.classList.replace("text-earthy-red", "text-white");
        } else {
          toast.classList.replace("bg-red-500", "bg-blush");
          toast.classList.replace("text-white", "text-earthy-red");
        }

        toast.classList.remove("translate-y-full", "opacity-0");
        toast.classList.add("translate-y-0", "opacity-100");

        setTimeout(() => {
          toast.classList.remove("translate-y-0", "opacity-100");
          toast.classList.add("translate-y-full", "opacity-0");
        }, 3000);
      }
    </script>

    <!-- Custom Tailwind Configuration - Brand colors and typography -->
    <script>
      tailwind.config = {
        theme: {
          extend: {
            // Custom color palette inspired by Ethiopian fashion and culture
            colors: {
              beige: "#F8F1ED", // Light background - warm neutral
              blush: "#F9DAD0", // Accent color - soft pink
              "earthy-red": "#E26D5A", // Primary brand color - warm terracotta
              charcoal: "#333333", // Dark text color for readability
            },
            // Custom font family for modern, clean typography
            fontFamily: {
              poppins: ["Poppins", "sans-serif"],
            },
          },
        },
      };
    </script>

    <!-- Custom Styles - Enhanced UI components and animations -->
    <style>
      /* Global body styling with elegant gradient background */
      body {
        /* Elegant gradient background for visual appeal */
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        background-attachment: fixed;
      }
      .app-screen,
      .app-modal {
        transition: opacity 0.3s ease;
      }
      /* Custom scrollbar for app content */
      .app-content {
        -ms-overflow-style: none; /* IE and Edge */
        scrollbar-width: none; /* Firefox */
      }
      .app-content::-webkit-scrollbar {
        display: none; /* Chrome, Safari, Opera */
      }

      /* Language Toggle Switch */
      .lang-toggle-checkbox:checked + .lang-toggle-label {
        background-color: #e26d5a;
      }
      .lang-toggle-checkbox:checked + .lang-toggle-label .lang-toggle-handle {
        transform: translateX(28px);
      }
      .lang-toggle-label {
        transition: background-color 0.2s ease;
      }
      .lang-toggle-handle {
        transition: transform 0.2s ease;
      }

      /* Enhanced Button Styles - Professional button components with animations */
      .btn-primary {
        /* Primary action button with gradient background and hover effects */
        @apply bg-gradient-to-r from-earthy-red to-red-500 text-white font-semibold py-4 px-6 rounded-2xl shadow-lg transition-all duration-300 ease-in-out transform;
        min-height: 56px;
        min-width: 120px;
        background: linear-gradient(135deg, #e26d5a 0%, #d63384 100%);
      }
      .btn-primary:hover:not(:disabled) {
        @apply bg-earthy-red/90 shadow-xl scale-[1.02];
      }
      .btn-primary:active:not(:disabled) {
        @apply bg-earthy-red/80 scale-[0.98];
      }
      .btn-primary:disabled {
        @apply bg-gray-300 text-gray-500 cursor-not-allowed scale-100 shadow-none;
      }

      .btn-secondary {
        @apply bg-white text-earthy-red font-semibold py-4 px-6 rounded-2xl shadow-lg border-2 border-earthy-red transition-all duration-200 ease-in-out transform;
        min-height: 56px;
        min-width: 120px;
      }
      .btn-secondary:hover:not(:disabled) {
        @apply bg-earthy-red text-white shadow-xl scale-[1.02];
      }
      .btn-secondary:active:not(:disabled) {
        @apply bg-earthy-red/90 scale-[0.98];
      }
      .btn-secondary:disabled {
        @apply bg-gray-100 text-gray-400 border-gray-300 cursor-not-allowed scale-100 shadow-none;
      }

      .btn-outline {
        @apply bg-transparent text-earthy-red font-semibold py-3 px-4 rounded-xl border-2 border-earthy-red transition-all duration-200 ease-in-out transform;
        min-height: 48px;
        min-width: 100px;
      }
      .btn-outline:hover:not(:disabled) {
        @apply bg-earthy-red text-white shadow-lg scale-[1.02];
      }
      .btn-outline:active:not(:disabled) {
        @apply bg-earthy-red/90 scale-[0.98];
      }
      .btn-outline:disabled {
        @apply bg-gray-100 text-gray-400 border-gray-300 cursor-not-allowed scale-100 shadow-none opacity-70;
      }

      .btn-ghost {
        @apply bg-transparent text-charcoal/70 font-medium py-2 px-3 rounded-lg transition-all duration-200 ease-in-out transform;
        min-height: 40px;
        min-width: 80px;
      }
      .btn-ghost:hover:not(:disabled) {
        @apply bg-blush/50 text-charcoal scale-[1.05];
      }
      .btn-ghost:active:not(:disabled) {
        @apply bg-blush scale-[0.95];
      }

      .btn-icon {
        @apply w-12 h-12 rounded-full bg-white/80 backdrop-blur-sm flex items-center justify-center transition-all duration-200 ease-in-out transform shadow-lg;
      }
      .btn-icon:hover:not(:disabled) {
        @apply bg-white shadow-xl scale-110;
      }
      .btn-icon:active:not(:disabled) {
        @apply scale-95;
      }

      .btn-nav {
        @apply flex flex-col items-center gap-1 py-2 px-3 rounded-xl transition-all duration-200 ease-in-out transform;
        min-height: 60px;
        min-width: 60px;
      }
      .btn-nav:hover:not(:disabled) {
        @apply bg-blush/30 scale-105;
      }
      .btn-nav.active {
        @apply text-earthy-red bg-blush/20;
      }

      /* Form Input Enhancements */
      .form-input,
      .form-select {
        @apply w-full p-4 rounded-xl border-2 border-blush bg-white focus:outline-none focus:ring-2 focus:ring-earthy-red focus:border-earthy-red transition-all duration-200 ease-in-out;
        min-height: 48px;
      }
      .form-input:invalid,
      .form-select:invalid {
        @apply border-red-300 bg-red-50;
      }
      .form-input:valid,
      .form-select:valid {
        @apply border-green-300 bg-green-50;
      }
      /* Style for placeholder */
      .form-select:invalid {
        color: #6b7280; /* gray-500 */
      }

      /* Loading States */
      .btn-loading {
        @apply cursor-wait;
      }
      .btn-loading .btn-text {
        @apply opacity-50;
      }
      .btn-loading .btn-spinner,
      .btn-loading .loader {
        @apply animate-spin;
      }

      /* Focus States for Accessibility */
      .btn-primary:focus-visible,
      .btn-secondary:focus-visible,
      .btn-outline:focus-visible,
      .btn-ghost:focus-visible,
      .btn-icon:focus-visible,
      .btn-nav:focus-visible {
        @apply outline-none ring-4 ring-earthy-red/30 ring-offset-2;
      }

      /* Touch-friendly sizing */
      @media (max-width: 768px) {
        .btn-primary,
        .btn-secondary {
          min-height: 60px;
          font-size: 18px;
        }
        .btn-outline {
          min-height: 52px;
          font-size: 16px;
        }
        .btn-icon {
          @apply w-14 h-14;
        }
        .btn-nav {
          min-height: 70px;
          min-width: 70px;
        }
      }

      /* Animation for button press feedback */
      @keyframes buttonPress {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(0.95);
        }
        100% {
          transform: scale(1);
        }
      }
      .btn-press-animation {
        animation: buttonPress 0.1s ease-in-out;
      }

      /* Success/Error States */
      .btn-success {
        @apply bg-green-500 text-white;
      }
      .btn-error {
        @apply bg-red-500 text-white;
      }

      /* Ripple Effect */
      .btn-ripple {
        position: relative;
        overflow: hidden;
      }
      .btn-ripple::before {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.3);
        transform: translate(-50%, -50%);
        transition: width 0.6s, height 0.6s;
      }
      .btn-ripple:active::before {
        width: 300px;
        height: 300px;
      }
    </style>
  </head>
  <body
    class="font-poppins bg-gray-200 flex items-center justify-center min-h-screen p-4"
  >
    <!-- App Container -->
    <div
      id="app-container"
      class="relative w-full max-w-[400px] h-[844px] max-h-[844px] bg-beige rounded-[40px] shadow-2xl overflow-hidden border-8 border-black"
    >
      <!-- App Content Area (Scrollable) -->
      <div class="app-content h-full overflow-y-auto">
        <!-- 1️⃣ Welcome / Login Screen -->
        <div
          id="screen-welcome"
          class="app-screen flex flex-col items-center justify-center h-full p-8 text-center bg-gradient-to-br from-beige via-blush to-pink-100"
        >
          <!-- Hero Image -->
          <div class="mb-8 w-full h-48 rounded-3xl overflow-hidden shadow-2xl">
            <img
              src="https://images.unsplash.com/photo-1441986300917-64674bd600d8?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1000&q=80"
              alt="Ethiopian Fashion Boutique"
              class="w-full h-full object-cover"
            />
          </div>

          <h1
            class="text-6xl font-bold text-charcoal mb-4 bg-gradient-to-r from-earthy-red to-pink-500 bg-clip-text text-transparent"
          >
            Jegnit Hub
          </h1>
          <p class="text-xl text-charcoal/80 mb-2 font-medium"></p>
          <p class="text-lg text-charcoal/70 mb-12">
            Connect sellers with buyers and delivery
          </p>

          <div class="w-full space-y-4">
            <button
              id="btn-seller"
              class="btn-primary btn-ripple w-full text-lg flex items-center justify-center gap-3"
              aria-label="I'm a Seller - Start selling your clothing items"
            >
              <span class="btn-text">Seller</span>
              <span class="text-2xl">🛍️</span>
            </button>
            <button
              id="btn-buyer"
              class="btn-secondary btn-ripple w-full text-lg flex items-center justify-center gap-3"
              aria-label="I'm a Buyer - Browse and buy clothing items"
            >
              <span class="btn-text">Buyer</span>
              <span class="text-2xl"> 🛒</span>
            </button>
            <!-- NEW DELIVERY BUTTON -->
            <button
              id="btn-delivery"
              class="btn-outline btn-ripple w-full text-lg flex items-center justify-center gap-3"
              aria-label="I'm a Delivery Person - Find delivery jobs"
            >
              <span class="btn-text">Delivery</span>
              <span class="text-2xl">🚚</span>
            </button>
          </div>

          <div class="absolute bottom-6 text-charcoal/60 text-sm">
            <a href="#" class="mx-2 hover:text-earthy-red transition-colors"
              >About Us</a
            >
            <a href="#" class="mx-2 hover:text-earthy-red transition-colors"
              >Privacy Policy</a
            >
            <a href="#" class="mx-2 hover:text-earthy-red transition-colors"
              >Terms of Service</a
            >
          </div>
        </div>

        <!-- 2️⃣ Seller Dashboard -->
        <div
          id="screen-seller-dashboard"
          class="app-screen hidden h-full flex flex-col"
        >
          <!-- Header -->
          <header
            class="p-4 flex items-center justify-between sticky top-0 bg-beige/80 backdrop-blur-sm z-10"
          >
            <div class="flex items-center gap-3">
              <img
                src="https://images.unsplash.com/photo-1494790108755-2616b612b786?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=100&q=80"
                alt="Amina Kebebe"
                class="w-12 h-12 rounded-full border-2 border-earthy-red/20"
              />
              <div>
                <h2 class="text-xl font-bold text-charcoal">
                  Amina's Boutique
                </h2>
                <p class="text-sm text-charcoal/70">
                  Ethiopian Fashion Designer
                </p>
              </div>
            </div>
            <div class="flex items-center gap-2">
              <button
                id="back-to-home-seller"
                class="btn-ghost text-sm"
                aria-label="Go back to home screen"
              >
                🏠 Home
              </button>
            </div>
          </header>

          <!-- Content -->
          <div class="p-4 flex-1 overflow-y-auto pb-24">
            <!-- Increased padding to prevent overlap -->
            <h3 class="text-lg font-semibold text-charcoal mb-4">
              My Products
            </h3>
            <div id="seller-products-grid" class="grid grid-cols-2 gap-4">
              <!-- Products rendered by JS -->
            </div>
          </div>
        </div>

        <!-- 3️⃣ Upload Product Screen -->
        <div
          id="screen-upload-product"
          class="app-screen hidden h-full flex flex-col"
        >
          <!-- Header -->
          <header
            class="p-4 flex items-center sticky top-0 bg-beige/80 backdrop-blur-sm z-10"
          >
            <button
              id="upload-back-btn"
              class="btn-ghost mr-2"
              aria-label="Go back to seller dashboard"
            >
              ← Back
            </button>
            <h2 class="text-xl font-bold text-charcoal">📸 Add Your Item</h2>
          </header>

          <!-- Content -->
          <div class="p-4 flex-1 overflow-y-auto pb-24">
            <!-- Increased padding to prevent overlap -->
            <form id="upload-product-form" class="space-y-4">
              <!-- Image Upload -->
              <div
                class="w-full h-48 bg-blush/50 rounded-2xl border-2 border-dashed border-blush flex items-center justify-center text-center text-earthy-red relative overflow-hidden cursor-pointer"
              >
                <div
                  id="image-preview-container"
                  class="absolute inset-0"
                ></div>
                <label
                  for="upload-image-input"
                  class="cursor-pointer z-10 p-4 w-full h-full flex flex-col items-center justify-center"
                >
                  <span
                    id="icon-upload-camera"
                    class="w-10 h-10 mx-auto"
                  ></span>
                  <p class="font-semibold mt-2">Upload Image</p>
                  <p class="text-sm mt-1">Click anywhere in this area</p>
                </label>
                <input
                  id="upload-image-input"
                  name="image"
                  type="file"
                  class="hidden"
                  accept="image/*"
                  required
                />
              </div>

              <!-- Form Fields -->
              <input
                type="text"
                id="upload-title"
                name="title"
                placeholder="Product Title (e.g., 'Habesha Kemis')"
                required
                class="form-input"
                aria-label="Product title"
                aria-describedby="title-help"
              />
              <div id="title-help" class="text-sm text-charcoal/60 -mt-2">
                Enter a descriptive title for your clothing item
              </div>

              <div class="grid grid-cols-2 gap-4">
                <div class="relative">
                  <select
                    id="upload-category"
                    name="category"
                    required
                    class="form-select"
                    aria-label="Product category"
                  >
                    <option value="" disabled selected>Category</option>
                    <option value="Dress">Dress</option>
                    <option value="Top">Top</option>
                    <option value="Bottom">Bottom</option>
                    <option value="Outerwear">Outerwear</option>
                  </select>
                  <div
                    class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-charcoal/70"
                  >
                    <svg
                      class="fill-current h-4 w-4"
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 20 20"
                    >
                      <path
                        d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"
                      />
                    </svg>
                  </div>
                </div>
                <div class="relative">
                  <select
                    id="upload-size"
                    name="size"
                    required
                    class="form-select"
                    aria-label="Product size"
                  >
                    <option value="" disabled selected>Size</option>
                    <option value="XS">XS</option>
                    <option value="S">S</option>
                    <option value="M">M</option>
                    <option value="L">L</option>
                    <option value="XL">XL</option>
                  </select>
                  <div
                    class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-charcoal/70"
                  >
                    <svg
                      class="fill-current h-4 w-4"
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 20 20"
                    >
                      <path
                        d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"
                      />
                    </svg>
                  </div>
                </div>
              </div>

              <input
                type="text"
                id="upload-color"
                name="color"
                placeholder="Main Color "
                required
                class="form-input"
                aria-label="Main color"
              />
              <input
                type="number"
                id="upload-price"
                name="price"
                placeholder="Price (ETB)"
                required
                class="form-input"
                aria-label="Price in Ethiopian Birr"
                min="1"
                step="1"
              />
              <input
                type="text"
                id="upload-location"
                name="location"
                placeholder="Location "
                required
                class="form-input"
                aria-label="Location"
              />
              <textarea
                id="upload-notes"
                name="notes"
                placeholder="Seller Note"
                class="form-input"
                rows="3"
                aria-label="Additional notes about the product"
              ></textarea>

              <!-- AI Generation -->
              <button
                id="btn-generate-desc"
                type="button"
                class="btn-primary w-full bg-charcoal hover:bg-charcoal/90 active:bg-charcoal/80 flex items-center justify-center gap-2"
                aria-label="Generate AI description for your product"
              >
                <span class="btn-spinner loader hidden"></span>
                <span class="btn-text icon"></span>
                <span class="btn-text">Generate Description</span>
              </button>

              <!-- AI Results -->
              <div
                id="ai-results-container"
                class="hidden space-y-3 bg-white p-4 rounded-xl border border-blush"
              >
                <h4 class="font-semibold text-charcoal">Generated Content:</h4>
                <p id="ai-generated-en" class="text-sm text-charcoal"></p>
                <p id="ai-generated-am" class="text-sm text-charcoal"></p>
                <div id="ai-tags-container" class="flex flex-wrap gap-2">
                  <!-- Tags rendered by JS -->
                </div>
              </div>

              <!-- Hidden fields for AI data -->
              <input type="hidden" id="hidden-desc-en" name="hidden-desc-en" />
              <input type="hidden" id="hidden-desc-am" name="hidden-desc-am" />
              <input type="hidden" id="hidden-tags" name="hidden-tags" />
              <input type="hidden" id="hidden-style" name="hidden-style" />

              <!-- Publish Button -->
              <button
                id="btn-publish-product"
                type="submit"
                disabled
                class="btn-primary w-full text-lg flex items-center justify-center gap-2 mb-6"
                aria-label="Publish your product to the marketplace"
              >
                <span class="btn-text">Publish Product</span>
                <span class="btn-text icon"></span>
              </button>
            </form>
          </div>
        </div>

        <!-- 3.5️⃣ Seller Workspace Screen -->
        <div
          id="screen-seller-workspace"
          class="app-screen hidden h-full flex flex-col"
        >
          <!-- Header -->
          <header
            class="p-4 flex items-center justify-between sticky top-0 bg-beige/80 backdrop-blur-sm z-10"
          >
            <div class="flex items-center gap-3">
              <img
                src="https://images.unsplash.com/photo-1494790108755-2616b612b786?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=100&q=80"
                alt="Seller Profile"
                class="w-12 h-12 rounded-full border-2 border-earthy-red/20"
              />
              <div>
                <h2 class="text-xl font-bold text-charcoal">My Workspace</h2>
                <p class="text-sm text-charcoal/70">
                  Manage your products & connect
                </p>
              </div>
            </div>
            <div class="flex items-center gap-2">
              <button
                id="back-to-home-seller-workspace"
                class="btn-ghost text-sm"
                aria-label="Go back to home"
              >
                🏠 Home
              </button>
            </div>
          </header>

          <!-- Content -->
          <div class="p-4 flex-1 overflow-y-auto pb-24">
            <!-- Quick Actions -->
            <div class="grid grid-cols-2 gap-4 mb-6">
              <button
                id="btn-add-product-workspace"
                class="btn-primary flex items-center justify-center gap-2 py-4"
                aria-label="Add new product"
              >
                <span class="text-2xl">📸</span>
                <span class="btn-text">Add Product</span>
              </button>
              <button
                id="btn-connect-sellers"
                class="btn-secondary flex items-center justify-center gap-2 py-4"
                aria-label="Connect with other sellers"
              >
                <span class="text-2xl">🤝</span>
                <span class="btn-text">Connect</span>
              </button>
            </div>

            <!-- Stats -->
            <div class="grid grid-cols-3 gap-4 mb-6">
              <div class="bg-white rounded-xl p-4 text-center shadow-sm">
                <p
                  class="text-2xl font-bold text-earthy-red"
                  id="workspace-products-count"
                >
                  0
                </p>
                <p class="text-sm text-charcoal/70">Products</p>
              </div>
              <div class="bg-white rounded-xl p-4 text-center shadow-sm">
                <p
                  class="text-2xl font-bold text-earthy-red"
                  id="workspace-views-count"
                >
                  0
                </p>
                <p class="text-sm text-charcoal/70">Views</p>
              </div>
              <div class="bg-white rounded-xl p-4 text-center shadow-sm">
                <p
                  class="text-2xl font-bold text-earthy-red"
                  id="workspace-connections-count"
                >
                  0
                </p>
                <p class="text-sm text-charcoal/70">Connections</p>
              </div>
            </div>

            <!-- My Products -->
            <h3 class="text-lg font-semibold text-charcoal mb-4">
              My Products
            </h3>
            <div id="seller-workspace-grid" class="grid grid-cols-2 gap-4">
              <!-- Products rendered by JS -->
            </div>
          </div>
        </div>

        <!-- 4️⃣ Product Detail Screen (for buyers) -->
        <div
          id="screen-product-detail"
          class="app-screen hidden h-full flex flex-col"
        >
          <!-- Header -->
          <header class="p-4 flex items-center absolute top-0 left-0 z-10">
            <button
              id="detail-back-btn"
              class="btn-icon bg-black/30 text-white hover:bg-black/50"
              aria-label="Go back to product feed"
            >
              ← Back
            </button>
          </header>

          <!-- Content -->
          <div class="flex-1 overflow-y-auto pb-20">
            <img
              id="detail-image"
              src=""
              alt=""
              class="w-full h-96 object-cover"
            />

            <div
              class="p-4 -mt-4 bg-beige rounded-t-2xl relative z-20 space-y-4"
            >
              <h2
                id="detail-title"
                class="text-3xl font-bold text-charcoal"
              ></h2>
              <p
                id="detail-price"
                class="text-2xl font-semibold text-earthy-red"
              ></p>

              <!-- NEW: Delivery Status Container -->
              <div id="delivery-status-container" class="hidden">
                <!-- Delivery status rendered by JS -->
              </div>

              <div id="detail-tags" class="flex flex-wrap gap-2">
                <!-- Tags rendered by JS -->
              </div>

              <!-- Language Toggle -->
              <div class="flex items-center justify-between py-2">
                <span class="text-charcoal font-semibold">Description</span>
                <div class="flex items-center gap-2 text-sm font-medium">
                  <span class="text-charcoal/70">🇬🇧 EN</span>
                  <input
                    type="checkbox"
                    id="lang-toggle"
                    class="hidden lang-toggle-checkbox"
                  />
                  <label
                    for="lang-toggle"
                    class="cursor-pointer w-14 h-8 bg-blush rounded-full flex items-center p-1 lang-toggle-label"
                  >
                    <span
                      class="w-6 h-6 bg-white rounded-full shadow-md lang-toggle-handle"
                    ></span>
                  </label>
                  <span class="text-charcoal/70">🇪🇹 AM</span>
                </div>
              </div>

              <!-- Descriptions -->
              <p id="detail-desc-en" class="text-charcoal/80"></p>
              <p id="detail-desc-am" class="text-charcoal/80 hidden"></p>

              <!-- Delivery Options -->
              <div class="bg-white rounded-xl p-4 mb-4">
                <h4 class="text-lg font-semibold text-charcoal mb-3">
                  🚚 Delivery Options
                </h4>
                <div class="space-y-3">
                  <label
                    class="flex items-center p-3 bg-gray-50 border border-gray-200 rounded-lg cursor-pointer hover:border-earthy-red/50 transition-colors"
                  >
                    <input
                      type="radio"
                      name="product-delivery-option"
                      value="pickup"
                      class="sr-only peer"
                      checked
                    />
                    <div
                      class="w-4 h-4 border-2 border-gray-300 rounded-full peer-checked:border-earthy-red peer-checked:bg-earthy-red mr-3 flex items-center justify-center"
                    >
                      <div
                        class="w-2 h-2 bg-white rounded-full opacity-0 peer-checked:opacity-100"
                      ></div>
                    </div>
                    <div class="flex-1">
                      <div class="font-semibold text-charcoal">
                        🏪 Pickup at Store
                      </div>
                      <div class="text-sm text-charcoal/70">
                        Free - Available immediately
                      </div>
                    </div>
                  </label>

                  <label
                    class="flex items-center p-3 bg-gray-50 border border-gray-200 rounded-lg cursor-pointer hover:border-earthy-red/50 transition-colors"
                  >
                    <input
                      type="radio"
                      name="product-delivery-option"
                      value="delivery"
                      class="sr-only peer"
                    />
                    <div
                      class="w-4 h-4 border-2 border-gray-300 rounded-full peer-checked:border-earthy-red peer-checked:bg-earthy-red mr-3 flex items-center justify-center"
                    >
                      <div
                        class="w-2 h-2 bg-white rounded-full opacity-0 peer-checked:opacity-100"
                      ></div>
                    </div>
                    <div class="flex-1">
                      <div class="font-semibold text-charcoal">
                        🚚 Home Delivery
                      </div>
                      <div class="text-sm text-charcoal/70">
                        50 ETB - Same day delivery
                      </div>
                    </div>
                  </label>
                </div>
              </div>

              <!-- CTA -->
              <button
                id="btn-buy-product"
                class="btn-primary w-full text-lg flex items-center justify-center gap-3"
                aria-label="Buy this product"
              >
                <span class="btn-text">🛒 Buy Now</span>
              </button>
            </div>
          </div>
        </div>

        <!-- 5️⃣ Buyer Onboarding -->
        <div
          id="screen-buyer-onboarding"
          class="app-screen hidden h-full flex flex-col justify-center p-6"
        >
          <header
            class="p-4 flex items-center justify-between sticky top-0 bg-beige/80 backdrop-blur-sm z-10"
          >
            <h2 class="text-xl font-bold text-charcoal">Find Your Style</h2>
            <button
              id="back-to-home-buyer"
              class="btn-ghost text-sm"
              aria-label="Go back to home screen"
            >
              Home
            </button>
          </header>

          <div class="flex-1 flex flex-col justify-center">
            <h2 class="text-3xl font-bold text-charcoal text-center mb-4">
              Discover Your Perfect Style
            </h2>
            <p class="text-lg text-charcoal/70 text-center mb-8">
              Let's personalize your shopping experience
            </p>

            <div class="space-y-4">
              <!-- Instagram (Mock) -->
              <button
                id="btn-connect-instagram"
                class="w-full bg-white p-6 rounded-2xl shadow-lg text-left hover:shadow-xl transition-all duration-200 transform hover:scale-[1.02] active:scale-[0.98]"
                aria-label="Connect Instagram to analyze your style preferences"
              >
                <h3 class="text-xl font-semibold text-charcoal mb-1">
                  📸 Connect Instagram
                </h3>
                <p class="text-charcoal/70">
                  Analyze your style preferences from your Instagram likes to
                  get personalized recommendations.
                </p>
              </button>

              <!-- Style Quiz -->
              <div class="w-full bg-white p-6 rounded-2xl shadow-lg text-left">
                <h3 class="text-xl font-semibold text-charcoal mb-3">
                  🎨 Style Quiz
                </h3>
                <p class="text-charcoal/70 mb-4">
                  Choose your favorite aesthetic to get personalized
                  recommendations:
                </p>
                <div class="grid grid-cols-2 gap-3">
                  <button
                    id="btn-quiz-boho"
                    class="btn-outline p-4 bg-gradient-to-br from-purple-50 to-pink-50 hover:from-purple-100 hover:to-pink-100 hover:bg-earthy-red hover:text-white transition-all duration-300"
                    aria-label="Select Boho style"
                  >
                    <div class="text-center">
                      <div class="text-2xl mb-1">🌸</div>
                      <div class="font-semibold">Boho</div>
                      <div class="text-xs opacity-70">
                        Free-spirited & artistic
                      </div>
                    </div>
                  </button>
                  <button
                    id="btn-quiz-minimal"
                    class="btn-outline p-4 bg-gradient-to-br from-gray-50 to-slate-50 hover:from-gray-100 hover:to-slate-100 hover:bg-earthy-red hover:text-white transition-all duration-300"
                    aria-label="Select Minimal style"
                  >
                    <div class="text-center">
                      <div class="text-2xl mb-1">⚪</div>
                      <div class="font-semibold">Minimal</div>
                      <div class="text-xs opacity-70">
                        Clean & sophisticated
                      </div>
                    </div>
                  </button>
                  <button
                    id="btn-quiz-bright"
                    class="btn-outline p-4 bg-gradient-to-br from-yellow-50 to-orange-50 hover:from-yellow-100 hover:to-orange-100 hover:bg-earthy-red hover:text-white transition-all duration-300"
                    aria-label="Select Bright style"
                  >
                    <div class="text-center">
                      <div class="text-2xl mb-1">🌈</div>
                      <div class="font-semibold">Bright</div>
                      <div class="text-xs opacity-70">Vibrant & energetic</div>
                    </div>
                  </button>
                  <button
                    id="btn-quiz-earthy"
                    class="btn-outline p-4 bg-gradient-to-br from-green-50 to-emerald-50 hover:from-green-100 hover:to-emerald-100 hover:bg-earthy-red hover:text-white transition-all duration-300"
                    aria-label="Select Earthy style"
                  >
                    <div class="text-center">
                      <div class="text-2xl mb-1">🌿</div>
                      <div class="font-semibold">Earthy</div>
                      <div class="text-xs opacity-70">Natural & grounded</div>
                    </div>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Consent Popup (for Instagram) -->
          <div
            id="consent-popup"
            class="hidden absolute inset-0 bg-black/30 flex items-center justify-center p-6 z-50"
          >
            <div
              class="bg-white p-6 rounded-2xl shadow-xl max-w-sm text-center"
            >
              <div class="text-4xl mb-4">🔒</div>
              <h3 class="text-lg font-semibold text-charcoal mb-3">
                Privacy First
              </h3>
              <p class="text-charcoal/80 mb-6">
                We'll only analyze your public Instagram likes to understand
                your style preferences. We never post, share, or store your
                personal data.
              </p>
              <div class="flex gap-4">
                <button
                  id="btn-consent-cancel"
                  class="btn-secondary flex-1"
                  aria-label="Cancel Instagram connection"
                >
                  Cancel
                </button>
                <button
                  id="btn-consent-agree"
                  class="btn-primary flex-1"
                  aria-label="Agree to Instagram connection"
                >
                  Agree
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- 6️⃣ Buyer Feed / Recommendations -->
        <div
          id="screen-buyer-feed"
          class="app-screen hidden h-full flex flex-col"
        >
          <!-- Header -->
          <header class="p-4 sticky top-0 bg-beige/80 backdrop-blur-sm z-10">
            <div class="flex items-center justify-between mb-3">
              <h2 class="text-2xl font-bold text-charcoal">
                Recommended for You
              </h2>
              <button
                id="back-to-home"
                class="btn-ghost text-sm"
                aria-label="Go back to home screen"
              >
                Home
              </button>
            </div>

            <!-- Search and Filter Bar -->
            <div class="space-y-2">
              <div class="relative">
                <input
                  type="text"
                  id="search-input"
                  placeholder="Search products..."
                  class="form-input pl-10"
                  aria-label="Search products"
                />
                <div
                  class="absolute left-3 top-1/2 transform -translate-y-1/2 text-charcoal/60"
                >
                  <svg
                    class="w-5 h-5"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                    ></path>
                  </svg>
                </div>
              </div>

              <!-- Filter Buttons -->
              <div class="flex gap-2 overflow-x-auto pb-2">
                <button
                  id="filter-all"
                  class="btn-outline px-3 py-1 text-sm whitespace-nowrap active"
                >
                  All
                </button>
                <button
                  id="filter-dress"
                  class="btn-outline px-3 py-1 text-sm whitespace-nowrap"
                >
                  Dresses
                </button>
                <button
                  id="filter-top"
                  class="btn-outline px-3 py-1 text-sm whitespace-nowrap"
                >
                  Tops
                </button>
                <button
                  id="filter-bottom"
                  class="btn-outline px-3 py-1 text-sm whitespace-nowrap"
                >
                  Bottoms
                </button>
                <button
                  id="filter-accessories"
                  class="btn-outline px-3 py-1 text-sm whitespace-nowrap"
                >
                  Accessories
                </button>
              </div>
            </div>
          </header>

          <!-- Content -->
          <div class="p-4 flex-1 overflow-y-auto pb-20" id="feed-content">
            <!-- Pull to refresh indicator -->
            <div
              id="pull-refresh-indicator"
              class="text-center py-4 text-charcoal/60 hidden"
            >
              <div class="inline-flex items-center gap-2">
                <svg
                  class="w-5 h-5 animate-spin"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
                  ></path>
                </svg>
                <span>Refreshing...</span>
              </div>
            </div>

            <div id="buyer-feed-grid" class="grid grid-cols-2 gap-4">
              <!-- Products rendered by JS -->
            </div>
          </div>
        </div>

        <!-- 8️⃣ Buyer Profile Screen -->
        <div
          id="screen-buyer-profile"
          class="app-screen hidden h-full flex flex-col"
        >
          <!-- Header -->
          <header class="p-4 sticky top-0 bg-beige/80 backdrop-blur-sm z-10">
            <div class="flex items-center justify-between">
              <h2 class="text-2xl font-bold text-charcoal">My Profile</h2>
              <button
                id="back-to-feed"
                class="btn-ghost text-sm"
                aria-label="Go back to feed"
              >
                Back
              </button>
            </div>
          </header>

          <!-- Content -->
          <div class="p-4 flex-1 overflow-y-auto pb-20">
            <!-- Profile Info -->
            <div class="bg-white rounded-2xl p-6 mb-4 shadow-sm">
              <div class="flex items-center gap-4 mb-4">
                <img
                  src="https://images.unsplash.com/photo-1438761681033-6461ffad8d80?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=200&q=80"
                  alt="Sarah M."
                  class="w-20 h-20 rounded-full border-3 border-earthy-red/20"
                />
                <div>
                  <h3 class="text-xl font-bold text-charcoal">
                    Sarah Mekonnen
                  </h3>
                  <p class="text-charcoal/70">Fashion Enthusiast</p>
                  <p class="text-sm text-charcoal/60">
                    📍 Addis Ababa, Ethiopia
                  </p>
                </div>
              </div>

              <div class="grid grid-cols-3 gap-4 text-center">
                <div class="bg-blush/30 rounded-xl p-3">
                  <p class="text-2xl font-bold text-earthy-red"></p>
                  <p class="text-sm text-charcoal/70">Favorites</p>
                </div>
                <div class="bg-blush/30 rounded-xl p-3">
                  <p class="text-2xl font-bold text-earthy-red"></p>
                  <p class="text-sm text-charcoal/70">Style</p>
                </div>
                <div class="bg-blush/30 rounded-xl p-3">
                  <p class="text-2xl font-bold text-earthy-red">12</p>
                  <p class="text-sm text-charcoal/70">Contacts</p>
                </div>
              </div>
            </div>

            <!-- Settings -->
            <div class="bg-white rounded-2xl p-6 shadow-sm mb-4">
              <h4 class="text-lg font-semibold text-charcoal mb-4">Settings</h4>
              <div class="space-y-3">
                <button
                  class="w-full text-left p-3 bg-blush/20 rounded-xl hover:bg-blush/30 transition-colors"
                >
                  <div class="flex items-center justify-between">
                    <span class="text-charcoal">Notifications</span>
                    <svg
                      class="w-5 h-5 text-charcoal/60"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M9 5l7 7-7 7"
                      ></path>
                    </svg>
                  </div>
                </button>
                <button
                  class="w-full text-left p-3 bg-blush/20 rounded-xl hover:bg-blush/30 transition-colors"
                >
                  <div class="flex items-center justify-between">
                    <span class="text-charcoal">Privacy</span>
                    <svg
                      class="w-5 h-5 text-charcoal/60"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M9 5l7 7-7 7"
                      ></path>
                    </svg>
                  </div>
                </button>
                <button
                  class="w-full text-left p-3 bg-blush/20 rounded-xl hover:bg-blush/30 transition-colors"
                >
                  <div class="flex items-center justify-between">
                    <span class="text-charcoal">Help & Support</span>
                    <svg
                      class="w-5 h-5 text-charcoal/60"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M9 5l7 7-7 7"
                      ></path>
                    </svg>
                  </div>
                </button>
              </div>
            </div>

            <!-- Actions -->
            <div class="space-y-3">
              <button
                class="btn-secondary w-full"
                onclick="showScreen('screen-buyer-onboarding')"
              >
                Retake Style Quiz
              </button>
              <button
                class="btn-outline w-full"
                onclick="showToast('Share feature coming soon!')"
              >
                Share Profile
              </button>
            </div>
          </div>
        </div>

        <!-- 9️⃣ Seller Profile Screen -->
        <div
          id="screen-seller-profile"
          class="app-screen hidden h-full flex flex-col"
        >
          <!-- Header -->
          <header class="p-4 sticky top-0 bg-beige/80 backdrop-blur-sm z-10">
            <div class="flex items-center justify-between">
              <h2 class="text-2xl font-bold text-charcoal">Seller Profile</h2>
              <button
                id="back-to-dashboard"
                class="btn-ghost text-sm"
                aria-label="Go back to dashboard"
              >
                Back
              </button>
            </div>
          </header>

          <!-- Content -->
          <div class="p-4 flex-1 overflow-y-auto pb-20">
            <!-- Profile Info -->
            <div class="bg-white rounded-2xl p-6 mb-4 shadow-sm">
              <div class="flex items-center gap-4 mb-4">
                <img
                  src="https://images.unsplash.com/photo-1494790108755-2616b612b786?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=200&q=80"
                  alt="Amina Kebebe"
                  class="w-20 h-20 rounded-full border-3 border-earthy-red/20"
                />
                <div>
                  <h3 class="text-xl font-bold text-charcoal">Amina Kebebe</h3>
                  <p class="text-charcoal/70">Ethiopian Fashion Designer</p>
                  <p class="text-sm text-charcoal/60">
                    📍 Addis Ababa, Ethiopia
                  </p>
                </div>
              </div>

              <div class="grid grid-cols-3 gap-4 text-center">
                <div class="bg-blush/30 rounded-xl p-3">
                  <p class="text-2xl font-bold text-earthy-red"></p>
                  <p class="text-sm text-charcoal/70">Products</p>
                </div>
                <div class="bg-blush/30 rounded-xl p-3">
                  <p class="text-2xl font-bold text-earthy-red"></p>
                  <p class="text-sm text-charcoal/70">Views</p>
                </div>
                <div class="bg-blush/30 rounded-xl p-3">
                  <p class="text-2xl font-bold text-earthy-red"></p>
                  <p class="text-sm text-charcoal/70">Contacts</p>
                </div>
              </div>
            </div>

            <!-- Analytics -->
            <div class="bg-white rounded-2xl p-6 shadow-sm mb-4">
              <h4 class="text-lg font-semibold text-charcoal mb-4">
                Analytics
              </h4>
              <div class="space-y-3">
                <div
                  class="flex justify-between items-center p-3 bg-blush/20 rounded-xl"
                >
                  <span class="text-charcoal">Total Views</span>
                  <span class="font-semibold text-earthy-red"></span>
                </div>
                <div
                  class="flex justify-between items-center p-3 bg-blush/20 rounded-xl"
                >
                  <span class="text-charcoal">Total Contacts</span>
                  <span class="font-semibold text-earthy-red"></span>
                </div>
                <div
                  class="flex justify-between items-center p-3 bg-blush/20 rounded-xl"
                >
                  <span class="text-charcoal">Conversion Rate</span>
                  <span class="font-semibold text-earthy-red"></span>
                </div>
              </div>
            </div>

            <!-- Settings -->
            <div class="bg-white rounded-2xl p-6 shadow-sm mb-4">
              <h4 class="text-lg font-semibold text-charcoal mb-4">Settings</h4>
              <div class="space-y-3">
                <button
                  class="w-full text-left p-3 bg-blush/20 rounded-xl hover:bg-blush/30 transition-colors"
                >
                  <div class="flex items-center justify-between">
                    <span class="text-charcoal">Store Settings</span>
                    <svg
                      class="w-5 h-5 text-charcoal/60"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M9 5l7 7-7 7"
                      ></path>
                    </svg>
                  </div>
                </button>
                <button
                  class="w-full text-left p-3 bg-blush/20 rounded-xl hover:bg-blush/30 transition-colors"
                >
                  <div class="flex items-center justify-between">
                    <span class="text-charcoal">Payment Settings</span>
                    <svg
                      class="w-5 h-5 text-charcoal/60"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M9 5l7 7-7 7"
                      ></path>
                    </svg>
                  </div>
                </button>
                <button
                  class="w-full text-left p-3 bg-blush/20 rounded-xl hover:bg-blush/30 transition-colors"
                >
                  <div class="flex items-center justify-between">
                    <span class="text-charcoal">Help & Support</span>
                    <svg
                      class="w-5 h-5 text-charcoal/60"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M9 5l7 7-7 7"
                      ></path>
                    </svg>
                  </div>
                </button>
              </div>
            </div>

            <!-- Actions -->
            <div class="space-y-3">
              <button
                class="btn-secondary w-full"
                onclick="showScreen('screen-upload-product')"
              >
                Add New Product
              </button>
              <button
                class="btn-outline w-full"
                onclick="showToast('Export feature coming soon!')"
              >
                Export Analytics
              </button>
            </div>
          </div>
        </div>

        <!-- 10️⃣ NEW: Delivery Onboarding/Profile Screen -->
        <div
          id="screen-delivery-onboarding"
          class="app-screen hidden h-full flex flex-col"
        >
          <!-- Header -->
          <header
            class="p-4 flex items-center sticky top-0 bg-beige/80 backdrop-blur-sm z-10"
          >
            <button
              id="delivery-onboarding-back-btn"
              class="btn-ghost mr-2"
              aria-label="Go back to home screen"
            >
              ← Back
            </button>
            <h2
              id="delivery-onboarding-title"
              class="text-xl font-bold text-charcoal"
            >
              Create Your Delivery Profile
            </h2>
          </header>

          <!-- Content -->
          <div class="p-4 flex-1 overflow-y-auto pb-24">
            <form id="delivery-profile-form" class="space-y-4">
              <!-- Photo Upload -->
              <div
                class="w-32 h-32 bg-blush/50 rounded-full border-2 border-dashed border-blush flex items-center justify-center text-center text-earthy-red relative overflow-hidden cursor-pointer mx-auto"
              >
                <div
                  id="delivery-image-preview"
                  class="absolute inset-0 flex items-center justify-center"
                >
                  <span class="text-3xl text-charcoal/60">${icons.camera}</span>
                </div>
                <label
                  for="delivery-photo-input"
                  class="cursor-pointer z-10 w-full h-full rounded-full"
                  aria-label="Upload profile photo"
                ></label>
                <input
                  id="delivery-photo-input"
                  name="photo"
                  type="file"
                  class="hidden"
                  accept="image/*"
                  required
                />
              </div>
              <p class="text-center text-charcoal/70 -mt-2">
                Tap to upload a photo
              </p>

              <!-- Form Fields -->
              <div class="relative">
                <span
                  class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-charcoal/50"
                ></span>
                <input
                  type="text"
                  id="delivery-full-name"
                  name="delivery-full-name"
                  placeholder="Full Name"
                  required
                  class="form-input pl-12"
                  aria-label="Full Name"
                />
              </div>

              <div class="relative">
                <span
                  class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-charcoal/50"
                ></span>
                <input
                  type="text"
                  id="delivery-location"
                  name="delivery-location"
                  placeholder="Nearby Location (e.g., 'Bole')"
                  required
                  class="form-input pl-12"
                  aria-label="Nearby Location"
                />
              </div>

              <div class="relative">
                <span
                  class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-charcoal/50"
                ></span>
                <input
                  type="text"
                  id="delivery-id-number"
                  name="delivery-id-number"
                  placeholder="ID Number"
                  required
                  class="form-input pl-12"
                  aria-label="ID Number"
                />
              </div>

              <!-- Available Status Toggle -->
              <div
                class="flex items-center justify-between bg-white p-4 rounded-xl border-2 border-blush"
              >
                <label for="delivery-status-toggle" class="cursor-pointer">
                  <input
                    type="checkbox"
                    id="delivery-status-toggle"
                    name="delivery-status-toggle"
                    class="hidden"
                  />
                  <span
                    id="delivery-status-icon"
                    class="text-4xl text-gray-400 transition-colors"
                  >
                  </span>
                </label>
              </div>

              <!-- Submit Button -->
              <button
                id="btn-submit-delivery-profile"
                type="submit"
                class="btn-primary w-full text-lg flex items-center justify-center gap-2 mb-6"
                aria-label="Submit profile"
              >
                <span class="btn-spinner loader hidden"></span>
                <span class="btn-text">Submit Profile</span>
              </button>
            </form>
          </div>
        </div>

        <!-- 11️⃣ NEW: Delivery Dashboard Screen -->
        <div
          id="screen-delivery-dashboard"
          class="app-screen hidden h-full flex flex-col"
        >
          <!-- Header -->
          <header
            class="p-4 flex items-center justify-between sticky top-0 bg-beige/80 backdrop-blur-sm z-10"
          >
            <div class="flex items-center gap-3">
              <img
                src="https://placehold.co/100x100/F9DAD0/333333?text=Dani"
                alt="Dani G."
                class="w-12 h-12 rounded-full border-2 border-earthy-red/20"
              />
              <div>
                <h2 class="text-xl font-bold text-charcoal">Delivery Home</h2>
                <p class="text-sm text-charcoal/70">Welcome, Dani!</p>
                <!-- Hardcoded name -->
              </div>
            </div>
            <div class="flex items-center gap-2">
              <button
                id="delivery-logout-btn"
                class="btn-ghost text-sm"
                aria-label="Log out"
              >
                <span class="w-6 h-6">${icons.logOut}</span>
              </button>
            </div>
          </header>

          <!-- Tabs -->
          <div
            class="flex border-b border-blush sticky top-[76px] bg-beige/80 backdrop-blur-sm z-10"
          >
            <button
              id="delivery-tabs-incoming"
              class="flex-1 text-center font-semibold p-4 border-b-2 border-earthy-red text-earthy-red"
              aria-label="View incoming requests"
            >
              Incoming Requests
            </button>
            <button
              id="delivery-tabs-accepted"
              class="flex-1 text-center font-semibold p-4 border-b-2 border-transparent text-charcoal/60"
              aria-label="View my deliveries"
            >
              My Deliveries
            </button>
          </div>

          <!-- Content -->
          <div class="p-4 flex-1 overflow-y-auto pb-24 space-y-4">
            <!-- Incoming List -->
            <div id="delivery-incoming-list" class="space-y-4">
              <!-- Incoming jobs rendered by JS -->
            </div>

            <!-- Accepted List -->
            <div id="delivery-accepted-list" class="hidden space-y-4">
              <!-- Accepted jobs rendered by JS -->
            </div>
          </div>
        </div>
      </div>
      <!-- End App Content Area -->

      <!-- 7️⃣ Payment Modal -->
      <div id="modal-payment" class="app-modal hidden absolute inset-0 z-50">
        <!-- Backdrop -->
        <div id="payment-backdrop" class="absolute inset-0 bg-black/50"></div>

        <!-- Payment Modal Content -->
        <div
          class="absolute bottom-0 left-0 right-0 bg-white p-6 rounded-t-3xl shadow-2xl max-h-[80vh] overflow-y-auto"
        >
          <!-- Header -->
          <div class="flex items-center justify-between mb-6">
            <h3 class="text-2xl font-bold text-charcoal">
              💳 Complete Purchase
            </h3>
            <button
              id="close-payment-modal"
              class="btn-icon text-charcoal/60 hover:text-charcoal"
              aria-label="Close payment modal"
            >
              <svg
                class="w-6 h-6"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M6 18L18 6M6 6l12 12"
                ></path>
              </svg>
            </button>
          </div>

          <!-- Product Summary -->
          <div
            id="payment-product-summary"
            class="bg-gray-50 rounded-2xl p-4 mb-6"
          >
            <!-- Product details will be populated by JavaScript -->
          </div>

          <!-- Delivery Options -->
          <div class="mb-6">
            <h4 class="text-lg font-semibold text-charcoal mb-4">
              🚚 Delivery Options
            </h4>
            <div class="space-y-3">
              <label
                class="flex items-center p-4 bg-white border-2 border-gray-200 rounded-xl cursor-pointer hover:border-earthy-red/50 transition-colors"
              >
                <input
                  type="radio"
                  name="delivery-option"
                  value="pickup"
                  class="sr-only peer"
                />
                <div
                  class="w-5 h-5 border-2 border-gray-300 rounded-full peer-checked:border-earthy-red peer-checked:bg-earthy-red mr-4 flex items-center justify-center"
                >
                  <div
                    class="w-2 h-2 bg-white rounded-full opacity-0 peer-checked:opacity-100"
                  ></div>
                </div>
                <div class="flex-1">
                  <div class="font-semibold text-charcoal">
                    🏪 Pickup at Store
                  </div>
                  <div class="text-sm text-charcoal/70">
                    Free - Available immediately
                  </div>
                </div>
              </label>

              <label
                class="flex items-center p-4 bg-white border-2 border-gray-200 rounded-xl cursor-pointer hover:border-earthy-red/50 transition-colors"
              >
                <input
                  type="radio"
                  name="delivery-option"
                  value="delivery"
                  class="sr-only peer"
                />
                <div
                  class="w-5 h-5 border-2 border-gray-300 rounded-full peer-checked:border-earthy-red peer-checked:bg-earthy-red mr-4 flex items-center justify-center"
                >
                  <div
                    class="w-2 h-2 bg-white rounded-full opacity-0 peer-checked:opacity-100"
                  ></div>
                </div>
                <div class="flex-1">
                  <div class="font-semibold text-charcoal">
                    🚚 Home Delivery
                  </div>
                  <div class="text-sm text-charcoal/70">
                    50 ETB - Same day delivery
                  </div>
                </div>
              </label>
            </div>
          </div>

          <!-- Payment Method -->
          <div class="mb-6">
            <h4 class="text-lg font-semibold text-charcoal mb-4">
              💳 Payment Method
            </h4>
            <div class="space-y-3">
              <label
                class="flex items-center p-4 bg-white border-2 border-gray-200 rounded-xl cursor-pointer hover:border-earthy-red/50 transition-colors"
              >
                <input
                  type="radio"
                  name="payment-method"
                  value="cash"
                  class="sr-only peer"
                />
                <div
                  class="w-5 h-5 border-2 border-gray-300 rounded-full peer-checked:border-earthy-red peer-checked:bg-earthy-red mr-4 flex items-center justify-center"
                >
                  <div
                    class="w-2 h-2 bg-white rounded-full opacity-0 peer-checked:opacity-100"
                  ></div>
                </div>
                <div class="flex-1">
                  <div class="font-semibold text-charcoal">
                    💵 Cash on Delivery
                  </div>
                  <div class="text-sm text-charcoal/70">
                    Pay when you receive the item
                  </div>
                </div>
              </label>

              <label
                class="flex items-center p-4 bg-white border-2 border-gray-200 rounded-xl cursor-pointer hover:border-earthy-red/50 transition-colors"
              >
                <input
                  type="radio"
                  name="payment-method"
                  value="mobile"
                  class="sr-only peer"
                />
                <div
                  class="w-5 h-5 border-2 border-gray-300 rounded-full peer-checked:border-earthy-red peer-checked:bg-earthy-red mr-4 flex items-center justify-center"
                >
                  <div
                    class="w-2 h-2 bg-white rounded-full opacity-0 peer-checked:opacity-100"
                  ></div>
                </div>
                <div class="flex-1">
                  <div class="font-semibold text-charcoal">
                    📱 Mobile Payment
                  </div>
                  <div class="text-sm text-charcoal/70">
                    Telebirr, M-Pesa, or Bank Transfer
                  </div>
                </div>
              </label>
            </div>
          </div>

          <!-- Order Summary -->
          <div class="bg-gray-50 rounded-2xl p-4 mb-6">
            <h4 class="text-lg font-semibold text-charcoal mb-3">
              📋 Order Summary
            </h4>
            <div class="space-y-2">
              <div class="flex justify-between">
                <span class="text-charcoal/70">Product Price:</span>
                <span id="product-price" class="font-semibold text-charcoal"
                  >0 ETB</span
                >
              </div>
              <div class="flex justify-between">
                <span class="text-charcoal/70">Delivery:</span>
                <span id="delivery-cost" class="font-semibold text-charcoal"
                  >0 ETB</span
                >
              </div>
              <div class="border-t border-gray-300 pt-2">
                <div class="flex justify-between">
                  <span class="text-lg font-bold text-charcoal">Total:</span>
                  <span
                    id="total-price"
                    class="text-lg font-bold text-earthy-red"
                    >0 ETB</span
                  >
                </div>
              </div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="flex gap-3">
            <button id="cancel-payment" class="btn-secondary flex-1">
              Cancel
            </button>
            <button id="confirm-purchase" class="btn-primary flex-1">
              <span class="btn-text">Complete Purchase</span>
            </button>
          </div>
        </div>
      </div>

      <!-- 8️⃣ Contact Seller Popup (Modal) -->
      <div
        id="modal-contact-seller"
        class="app-modal hidden absolute inset-0 z-40"
      >
        <!-- Backdrop -->
        <div id="modal-backdrop" class="absolute inset-0 bg-black/50"></div>

        <!-- Modal Content -->
        <div
          class="absolute bottom-0 left-0 right-0 bg-beige p-6 rounded-t-3xl shadow-2xl space-y-4"
        >
          <img
            src="https://images.unsplash.com/photo-1494790108755-2616b612b786?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=100&q=80"
            alt="Amina Kebebe"
            class="w-16 h-16 rounded-full mx-auto -mt-14 border-4 border-beige shadow-lg"
          />
          <div class="text-center">
            <h3
              id="contact-seller-name"
              class="text-xl font-bold text-charcoal"
            ></h3>
            <p id="contact-seller-phone" class="text-lg text-charcoal/70"></p>
          </div>

          <a
            id="contact-whatsapp-link"
            href="#"
            target="_blank"
            class="btn-primary w-full bg-green-500 hover:bg-green-600 active:bg-green-700 text-lg flex items-center justify-center gap-3"
            aria-label="Send message via WhatsApp"
          >
            <span class="btn-text">Send via WhatsApp</span>
            <span class="w-6 h-6">${icons.whatsapp}</span>
          </a>
          <button
            id="btn-copy-number"
            class="btn-secondary w-full text-lg flex items-center justify-center gap-3"
            aria-label="Copy seller phone number"
          >
            <span class="btn-text">Copy Number</span>
            <span class="w-5 h-5">${icons.copy}</span>
          </button>
        </div>
      </div>

      <!-- Toast Notification -->
      <div
        id="toast"
        class="absolute bottom-20 left-4 right-4 bg-blush text-earthy-red font-semibold p-4 rounded-xl shadow-lg text-center transform translate-y-full opacity-0 transition-all duration-300 z-50"
      >
        <!-- Message set by JS -->
      </div>

      <!-- 🛍️ Bottom Navigation Bar (Buyer) -->
      <nav
        id="bottom-nav-buyer"
        class="hidden absolute bottom-0 left-0 right-0 bg-white/80 backdrop-blur-sm h-20 rounded-t-[30px] flex items-center justify-around text-charcoal/60 border-t border-blush z-30"
      >
        <button
          id="nav-home-buyer"
          class="btn-nav nav-item"
          aria-label="Go to home feed"
        >
          <!-- Icon JS -->
        </button>
        <button
          id="nav-favorites-buyer"
          class="btn-nav nav-item"
          aria-label="View favorite products"
        >
          <!-- Icon JS -->
        </button>
        <button
          id="nav-profile-buyer"
          class="btn-nav nav-item"
          aria-label="View your profile"
        >
          <!-- Icon JS -->
        </button>
      </nav>

      <!-- 👗 Bottom Navigation Bar (Seller) -->
      <nav
        id="bottom-nav-seller"
        class="hidden absolute bottom-0 left-0 right-0 bg-white/80 backdrop-blur-sm h-20 rounded-t-[30px] flex items-center justify-around text-charcoal/60 border-t border-blush z-30"
      >
        <button
          id="nav-home-seller"
          class="btn-nav nav-item"
          aria-label="View your products"
        >
          <!-- Icon JS -->
        </button>
        <button
          id="nav-upload-seller"
          class="btn-nav nav-item"
          aria-label="Upload new product"
        >
          <!-- Icon JS -->
        </button>
        <button
          id="nav-profile-seller"
          class="btn-nav nav-item"
          aria-label="View your profile"
        >
          <!-- Icon JS -->
        </button>
      </nav>

      <!-- 🚚 NEW: Bottom Navigation Bar (Delivery) -->
      <nav
        id="bottom-nav-delivery"
        class="hidden absolute bottom-0 left-0 right-0 bg-white/80 backdrop-blur-sm h-20 rounded-t-[30px] flex items-center justify-around text-charcoal/60 border-t border-blush z-30"
      >
        <button
          id="nav-home-delivery"
          class="btn-nav nav-item"
          aria-label="View delivery jobs"
        >
          <!-- Icon JS -->
        </button>
        <button
          id="nav-profile-delivery"
          class="btn-nav nav-item"
          aria-label="View your delivery profile"
        >
          <!-- Icon JS -->
        </button>
      </nav>
    </div>
    <!-- End App Container -->
  </body>
</html>
